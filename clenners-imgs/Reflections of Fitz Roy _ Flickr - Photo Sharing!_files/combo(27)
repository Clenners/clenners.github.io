YUI.add("sub-photo-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{initializer:function(e){return this.nsid=e.nsid,this.photoId=e.photoId,this.backToURL=e.backToURL,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},subviewConfig:{"sub-photo-left-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"sub-photo-right-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"sub-photo-keyboard-shortcuts-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1}},loadState:function(){return e.Promise.resolve()},buildContainer:function(){var e;return e=this.templates("sub-photo")({"sub-photo-left-view":this.subviews["sub-photo-left-view"].get("container"),"sub-photo-right-view":this.subviews["sub-photo-right-view"].get("container"),"sub-photo-keyboard-shortcuts-view":this.subviews["sub-photo-keyboard-shortcuts-view"].get("container")}),this.setContainerHTML(e),this},buildErrorContainer:function(){},activate:function(){return this}})},"@VERSION@",{requires:["flickr-view","hermes-template-sub-photo","sub-photo-css","url-helper"],optional:["sub-photo-left-view","sub-photo-right-view","sub-photo-keyboard-shortcuts-view"]});
YUI.add("hermes-template-mini-signup-footer",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){return"has-logo"}function d(e,t){return'\n		<div class="close-x"></div>\n	'}function v(e,t){var r="",i,s,o;r+="\n		",o={hash:{},inverse:c.program(8,g,t),fn:c.program(6,m,t),data:t},s=(i=n.isFlipped||e.isFlipped,i?i.call(e,e.flippers,"mini-signup-footer-avatar",o):h.call(e,"isFlipped",e.flippers,"mini-signup-footer-avatar",o));if(s||s===0)r+=s;return r+="\n	",r}function m(e,t){var r="",i;return r+='\n			<div class="avatar person" style="background-image: url(',(i=n.buddyIcon)?i=i.call(e,{hash:{},data:t}):(i=e.buddyIcon,i=typeof i===f?i.apply(e):i),r+=l(i)+')"></div>\n		',r}function g(e,t){return'\n			<div class="logo"></div>\n		'}function y(e,t){return'\n		<div class="logo"></div>\n	'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<div class="mini-signup-footer ',a={hash:{},inverse:c.noop,fn:c.program(1,p,i),data:i},u=(o=n.isNotFlipped||t.isNotFlipped,o?o.call(t,t.flippers,"mini-signup-footer-avatar",a):h.call(t,"isNotFlipped",t.flippers,"mini-signup-footer-avatar",a));if(u||u===0)s+=u;s+='">\n	',a={hash:{},inverse:c.noop,fn:c.program(3,d,i),data:i},u=(o=n.isFlipped||t.isFlipped,o?o.call(t,t.flippers,"mini-signup-footer-cancellable",a):h.call(t,"isFlipped",t.flippers,"mini-signup-footer-cancellable",a));if(u||u===0)s+=u;s+="\n	",u=n["if"].call(t,t.isProfilePage,{hash:{},inverse:c.program(10,y,i),fn:c.program(5,v,i),data:i});if(u||u===0)s+=u;return s+='\n	<p class="truncate">',(u=n.message)?u=u.call(t,{hash:{},data:i}):(u=t.message,u=typeof u===f?u.apply(t):u),s+=l(u)+'</p>\n	<a href="/signup" class="mini butt" data-track="miniSignupFooterSignupClick">',a={hash:{intlName:"sohp.SIGN_UP_WITH_YAHOO"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):h.call(t,"intlMessage",a)))+'</a>\n	<p class="signin">or <a href="/signin" data-track="miniSignupFooterSigninClick">',a={hash:{intlName:"common.SIGN_IN"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):h.call(t,"intlMessage",a)))+"</a><p>\n</div>\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/mini-signup-footer",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("mini-signup-footer-view",function(e,t){"use strict";var n=200;e.namespace("Views").SignUpFooterView=e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){this.set("pageNSID",e.nsid),this.set("groupID",e.groupId),this.set("pageType",e.pageType!==undefined?e.pageType:"profile"),this.set("messageIntlName",e.messageIntlName),this.set("query",e.searchTerm)},loadState:function(){var t=this;return this.get("pageType")==="profile"?this.appContext.getModel("person-models",this.get("pageNSID")).then(function(e){t.set("personModel",e)}):this.get("pageType")==="group"?this.appContext.getModel("group-info-models",this.get("groupID")).then(function(e){t.set("groupModel",e)}):e.Promise.resolve()},buildContainer:function(){var e,t={isProfilePage:this.get("pageType")==="profile"||this.get("pageType")==="group"};return this.get("pageType")==="profile"?(t.buddyIcon=this.appContext.flipper.isFlipped("mini-signup-footer-avatar")?this.get("personModel").getValue("buddyicon").default:"",t.message=this.intlMessage({intlName:"growth.MINI_SIGNUP_FOOTER_MESSAGE",username:this.get("personModel").getValue("displayname")})):this.get("pageType")==="explore"?t.message=this.intlMessage({intlName:"growth.MINI_SIGNUP_FOOTER_MESSAGE_EXPLORE"}):this.get("pageType")==="group"?(t.buddyIcon=this.appContext.flipper.isFlipped("mini-signup-footer-avatar")?this.get("groupModel").getValue("group").getValue("bestIconURL"):"",t.message=this.intlMessage({intlName:"growth.MINI_SIGNUP_FOOTER_MESSAGE",username:this.get("groupModel").getValue("group").getValue("title")})):t.message=this.intlMessage({intlName:"growth.MINI_SIGNUP_FOOTER_MESSAGE_SEARCH",query:this.get("query")}),e=this.templates("mini-signup-footer")(t),this.setContainerHTML(e),this},activate:function(){this.set("showPopup",!0),this.get("showPopup")&&(this.initialScroll=e.config.win.pageYOffset,this.signupFooterNode=this.get("container").one(".mini-signup-footer"),this.signupFooterHeight=parseInt(this.signupFooterNode.getStyle("height"),10),this.registerEventHandler(e.globalEvents.subscribe("window:scroll:nothrottle",this.handleScroll.bind(this)))),this.appContext.flipper.isFlipped("mini-signup-footer-cancellable")&&this.registerEventHandler(this.get("container").one(".close-x").on("click",this.handleCancelClick.bind(this)))},showMiniSignupFooter:function(){var t,n=e.StorageHelper.getItem("miniSignupFooterSeen"),r;return n?(n=e.moment(n,"x"),r=e.moment().subtract(1,"days"),r>n&&(t=!0)):t=!0,t},handleCancelClick:function(n){this.get("container").one(".mini-signup-footer")&&this.get("container").one(".mini-signup-footer").removeClass("show"),e.rapidTracker.beacon(t,"miniSignupFooterCancelClick"),this.set("showPopup",!1)},handleScroll:function(r){if(!this.get("showPopup"))return;var i=e.config.win.pageYOffset-this.initialScroll,s=i-n;Math.abs(i)>n||i<=0?Math.abs(this.signupFooterHeight-s)>=0&&i>0&&(this.signupFooterNode.hasClass("show")||(this.signupFooterNode.addClass("show"),e.rapidTracker.beacon(t,"miniSignupFooterShow"))):this.signupFooterNode.hasClass("show")&&!this.appContext.flipper.isFlipped("mini-signup-footer-cancellable")&&(this.signupFooterNode.removeClass("show"),e.rapidTracker.beacon(t,"miniSignupFooterHide"))}},{ATTRS:{isActiveViewAgnostic:{value:!0}}})},"@VERSION@",{requires:["flickr-view","hermes-template-mini-signup-footer","mini-signup-footer-css","storage-helper","moment"],optionalRequires:["global-events"],langBundles:["common","sohp","growth"]});
YUI.add("hermes-lang-sohp",function(e,t){e.Intl.add("hermes/sohp","en-US",{MAIN_BUCKET_HEADLINE:["Flickr. The home for all your photos."],MAIN_BUCKET_HEADLINE_NEW:["The home for all your photos."],MAIN_BUCKET_BODY:["Upload, access, organize, edit, and share your photos from any device, from anywhere in the world."],SIGN_UP_WITH_YAHOO:["Sign up with Yahoo"],SPACE_BUCKET_HEADLINE:["Never delete a photo again"],SPACE_BUCKET_BODY:["Get 1,000GB of free photo storage. We\u2019ll even help you automatically backup your entire collection."],PLATFORMS_BUCKET_HEADLINE:["Your photos from anywhere"],PLATFORMS_BUCKET_BODY:["Wherever you go your photos will follow you. See, edit, and share with our award-winning apps."],LEARN_MORE:["Learn more"],SEARCH_BUCKET_HEADLINE:["A quantum leap in search"],SEARCH_BUCKET_BODY:["We've made strides with photo search. It's now the fastest, easiest way to find the exact photo you want."],INSPIRATION_BUCKET_HEADLINE:["Breath-taking inspiration"],INSPIRATION_BUCKET_BODY:["Find beautiful photos shared by a community of amateur and professional photographers."],TAKE_MY_BREATH_AWAY:["Take my breath away"],GET_STARTED_WITH_STORAGE:["Get started with your free 1,000GB of photo storage"],INSPIRE_ME:["Inspire me"],SIGN_IN:["sign in"],PAGE_TITLE:["Flickr | The home for all your photos | Get 1,000GB free photo storage"],PAGE_DESCRIPTION:["The home for all your photos.  Upload, access, organize, edit, and share your photos from any device, from anywhere in the world.  Get 1,000GB of photo storage free."],SOHP_COMMUNITY_HEADLINE:["Your home for inspiring photography."],SOHP_COMMUNITY_SUBTITLE:["Discover the most interesting photos in the world."],SOHP_COMMUNITY_TITLE_INSPIRE:["Get Inspired"],SOHP_COMMUNITY_BODY_INSPIRE:["Browse trending photos every day from some of the biggest names in the world like NASA, The White House, Cuba Gallery."],SOHP_COMMUNITY_TITLE_PASSION:["Explore your passion"],SOHP_COMMUNITY_BODY_PASSION:["Connect with a dynamic community to  explore any interest you can imagine."],SOHP_COMMUNITY_TITLE_FIND:["Find the perfect photo"],SOHP_COMMUNITY_BODY_FIND:["Search over 12 billion photos like never before, by color, aesthetics, and licence type.  Your presentations will thank you."],SOHP_COMMUNITY_FOOTER:["Join the world's largest photography community"],SOHP_MANAGEMENT_HEADLINE:["The home for all your photos"],SOHP_MANAGEMENT_SUBTITLE:["Private photo management for all your devices."],SOHP_MANAGEMENT_TITLE_STORAGE:["Expansive storage"],SOHP_MANAGEMENT_BODY_STORAGE:["Never delete a photo or video again with 1,000 GB of free storage."],SOHP_MANAGEMENT_TITLE_BACKUP:["Automated backup"],SOHP_MANAGEMENT_BODY_BACKUP:["Automatically back up your entire collection from your computer, iOS, and Android device."],SOHP_MANAGEMENT_TITLE_ORGANIZATION:["Simple organization"],SOHP_MANAGEMENT_BODY_ORGANIZATION:["Organize hundreds of photos and videos using the camera roll view."],SOHP_MANAGEMENT_TITLE_SEARCH:["Smart search"],SOHP_MANAGEMENT_BODY_SEARCH:["Easily find the exact photo you want with our intelligent photo search."],SOHP_MANAGEMENT_TITLE_ACCESS:["Easy access"],SOHP_MANAGEMENT_BODY_ACCESS:["Access your photos and videos from anywhere with our award-winning apps."],SOHP_MANAGEMENT_TITLE_SHARING:["Seamless sharing"],SOHP_MANAGEMENT_BODY_SHARING:["Share your memories privately on any social network."],SOHP_MANAGEMENT_FOOTER:["Get started with your free 1,000 GB of photo storage"]})},"@VERSION@",{requires:["intl"]});
YUI.add("photo-page-scrappy-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){var n=this;this.backToURL=t.backToURL,this.hideBackToLink=t.hideBackToLink||!1,this.entryTypeIntlKey=t.entryTypeIntlKey,this.photoId=t.photoId,this.isOwner=t.isOwner,this.context=e.clone(t.context,!0),this.nsid=t.nsid,t.isOwner=this.isOwner,t.fullscreen?this.appContext.experiments.fullscreen.enableFullscreen():this.appContext.experiments.fullscreen.disableFullscreen(),this.appContext.getViewer().signedIn&&(t.signinPendingQueue=e.SigninHelper.checkPendingQueue(this.appContext));if(this.context&&this.context.params&&this.context.params.isSharedEntity){var r=this.context.params;this.appContext.setGPCredentials({gp_code:r.gpCode,gp_owner:r.gpOwner,share_code:r.gpCode})}else this.appContext.setGPCredentials(null);return this.appContext.getModel("photo-models",this.photoId).then(function(t){t.on("valuesChanged",function(t){t.title&&e.one&&e.one("head title").set("text",n.intlMessage({intlName:"photo-page-scrappy.PAGE_TITLE",title:t.title.newVal}))})}),YUI.Env.isServer&&this.appContext&&this.appContext.flipper.isFlipped("enable-better-photo-page-seo")&&(this.appContext.forceServerRender=this.appContext._doForcedServerRender()),this},subviewConfig:{"photo-well-scrappy-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,dealbreaker:!0},"photo-head-meta-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"global-nav-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"sub-photo-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"signup-footer-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,isPhotoPage:!0,disabled:function(e){return e.isMobile||!this.appContext.flipper.isFlipped("enable-sign-up-photo-page-footer")||this.appContext.getViewer().signedIn||this.appContext.lang!=="en-US"}},"mini-signup-footer-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(e){return e.isMobile||!this.appContext.flipper.isFlipped("enable-mini-sign-up-footer")||this.appContext.getViewer().signedIn||this.appContext.lang!=="en-US"}},"footer-full-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},additionalViewClasses:function(){var e=[];return!this.appContext.getViewer().signedIn&&this.appContext.flipper.isFlipped("global-nav-enabled")&&e.push("has-global-nav"),e},loadState:function(){var e=this;return this.appContext.getModel("photo-models",e.photoId).then(function(t){e.set("photo",t)})},buildContainer:function(){var t,n=this.subviews["photo-well-scrappy-view"].get("container"),r,i=!1;return i?r="":r=this.subviews["global-nav-view"].get("container"),t=this.templates("photo-page-scrappy")({"photo-well-view":n,"global-nav-view":r,"sub-photo-view":this.subviews["sub-photo-view"].get("container"),"signup-footer-view":this.subviews["signup-footer-view"]?this.subviews["signup-footer-view"].get("container"):"","mini-signup-footer-view":this.subviews["mini-signup-footer-view"]?this.subviews["mini-signup-footer-view"].get("container"):"","footer-full-view":this.subviews["footer-full-view"]?this.subviews["footer-full-view"].get("container"):""}),this.setContainerHTML(t),e.fletrics.increment("test.photo.page.requests"),this},activate:function(){var t=this,n;return this.appContext.adManager.isEnabled()&&(this.appContext.adManager.updatePhotoAdsCounter(),this.appContext.adManager.fetchAdIfRequired({spaceid:this.get("spaceid")})),this.appContext.flipper.isFlipped("enable-curator-tools")&&this.appContext.getViewer().isInsecureGod&&(n=new e.Views["curator-photo-tools-view"]({nsid:t.nsid,photoId:t.photoId}),n.appContext=this.appContext,n.loadState().then(function(){n.buildContainer(),n.activate(),this.curatorPhotoToolsView=n}),this.curatorPhotoToolsView=n),this},closeDialog:function(t){e.config.win.location.href=this.backToURL},onSubviewEvent:function(e,t){var n;if(t&&t.length>0&&!(t[0]==="make in view"&&t.length>1)&&t[0]!=="close in view")if(t[0]==="getDialogOffset")t[1]&&typeof t[1]=="function"&&(n=this.subviews["photo-well-scrappy-view"].get("container"),n&&t[1](parseInt(n.getStyle("right").replace("px",""),10)/2));else if(t[0]==="setRedirect")this.get("container").all("input[name=redirect_url]").setAttribute("value",window.location.pathname),typeof t[1]=="function"&&t[1]();else{if(t[0]==="rightClickPhoto")return!1;t[0]==="photo:reload"?this.reload(["photo-models","photostream-models","photo-exif-models"],this.photoId):(t[0]==="disable-sharing"||t[0]==="enable-sharing")&&this.fire("parentViewEvent",t[0])}},getTrackingSegments:function(){return{context:this.context.modelName.replace("-models",""),vwrOwner:this.isOwner?1:0}},destructor:function(){clearTimeout(this.scrollTimeout),this.curatorPhotoToolsView&&this.curatorPhotoToolsView.destroy()}},{ATTRS:{spaceid:{value:792600543}}}),e.Base.plug(e.Views[this.name],e.Plugin.FlickrView.TTFPRecorderPlugin,{selector:".main-photo"})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-page-scrappy","photo-css","util-css","fletrics","ttfp-recorder-plugin","signin-helper","dialog","overflow-helper","hermes-template-error-500","url","fluid-css","curator-photo-tools-view"],optional:["photo-well-scrappy-view","photo-head-meta-view","global-nav-view","sub-photo-view","mini-signup-footer-view"],langBundles:["common","photo-page-scrappy"]});
YUI.add("hermes-template-mobile-photo-page",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+="\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["global-nav-view"],u):a.call(t,"outlet",t["global-nav-view"],u)))+"\n\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["mobile-photo-well-view"],u):a.call(t,"outlet",t["mobile-photo-well-view"],u)))+"\n\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["mobile-photo-engagement-view"],u):a.call(t,"outlet",t["mobile-photo-engagement-view"],u)))+"\n\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["mobile-attribution-view"],u):a.call(t,"outlet",t["mobile-attribution-view"],u)))+"\n\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["photo-sidebar-actions-view"],u):a.call(t,"outlet",t["photo-sidebar-actions-view"],u)))+"\n\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["sub-photo-title-desc-view"],u):a.call(t,"outlet",t["sub-photo-title-desc-view"],u)))+"\n\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["mobile-sub-photo-stats-view"],u):a.call(t,"outlet",t["mobile-sub-photo-stats-view"],u)))+"\n\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["sub-photo-comments-view"],u):a.call(t,"outlet",t["sub-photo-comments-view"],u)))+"\n\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["photo-charm-exif-scrappy-view"],u):a.call(t,"outlet",t["photo-charm-exif-scrappy-view"],u)))+"\n\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["mobile-sub-photo-license-privacy-view"],u):a.call(t,"outlet",t["mobile-sub-photo-license-privacy-view"],u)))+"\n\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["sub-photo-tags-tag-view"],u):a.call(t,"outlet",t["sub-photo-tags-tag-view"],u)))+"\n\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["footer-full-view"],u):a.call(t,"outlet",t["footer-full-view"],u)))+"\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/mobile-photo-page",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-darla-script-setup",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t,n){var r="",i;return r+="\n<script>\n	var lang = '"+l((i=(i=n.selectedLang,i==null||i===!1?i:i.code),typeof i===f?i.apply(e):i))+'\';\n\n	if (lang === \'de-DE\') {\n		/* this should run out of band */\n		setTimeout(function () {\n			var darlaScriptElement = document.createElement("script");\n			darlaScriptElement.setAttribute("defer", "true");\n			darlaScriptElement.setAttribute("async", "true");\n			darlaScriptElement.setAttribute("src", "https://fc.yahoo.com/sdarla/php/client.php?f=2022219890&l=RS&npv=1&ref=https%3A//flickr.com&rtype=boot");\n			// for the future -- darlaScriptElement.onerror = function(){};\n			document.getElementsByTagName(\'head\')[0].appendChild(darlaScriptElement);\n		}, 100);\n	}\n</script>\n',r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;a={hash:{},inverse:c.noop,fn:c.programWithDepth(1,p,i,t),data:i},u=(o=n.isFlipped||t.isFlipped,o?o.call(t,t.flippers,"enable-darla-beacon",a):h.call(t,"isFlipped",t.flippers,"enable-darla-beacon",a));if(u||u===0)s+=u;return s+="\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/darla-script-setup",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-footer-full",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){var r="",i,s;return r+='\n<div class="foot-mobile-banner">\n	<a class="server-only-link" href="',(i=n.pageUrl)?i=i.call(e,{hash:{},data:t}):(i=e.pageUrl,i=typeof i===f?i.apply(e):i),r+=l(i)+'">',s={hash:{intlName:"common.TRY_MDOT"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):c.call(e,"intlMessage",s)))+"</a>\n</div>\n",r}function d(e,t){var r="",i;return r+='\n				<li class="foot-li">\n					<a class="opt-out-www server-only-link" href="',(i=n.pageUrl)?i=i.call(e,{hash:{},data:t}):(i=e.pageUrl,i=typeof i===f?i.apply(e):i),r+=l(i)+'">flickr.com</a>\n				</li>\n				',r}function v(e,t){var i="",s;i+='\n	<span id="tgt"><div id="tgtRS"></div></span>\n	',s=h.invokePartial(r["darla-script-setup"],"darla-script-setup",e,n,r,t);if(s||s===0)i+=s;return i+="\n",i}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=this.merge(r,e.partials),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;o=n["if"].call(t,t.isOptedOutOfMobile,{hash:{},inverse:h.noop,fn:h.program(1,p,i),data:i});if(o||o===0)s+=o;s+='\n<footer class="foot">\n	<div class="foot-container">\n		<div class="foot-top-row">\n			<ul class="foot-nav-ul">\n\n				',o=n["if"].call(t,t.hasNoOptOut,{hash:{},inverse:h.noop,fn:h.program(3,d,i),data:i});if(o||o===0)s+=o;s+='\n\n				<li class="foot-li"><a href="/about">',a={hash:{intlName:"common.ABOUT"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+'</a></li>\n				<li class="foot-li"><a href="/jobs">',a={hash:{intlName:"common.JOBS"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+'</a></li>\n				<li class="foot-li"><a href="//blog.flickr.net/en">',a={hash:{intlName:"common.BLOG"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+'</a></li>\n				<li class="foot-li"><a href="//mobile.yahoo.com/flickr">',a={hash:{intlName:"common.MOBILE"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+'</a></li>\n				<li class="foot-li"><a href="/services/developer">',a={hash:{intlName:"common.DEVELOPERS"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+'</a></li>\n				<li class="foot-li"><a href="/help/guidelines">',a={hash:{intlName:"common.GUIDELINES"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+'</a></li>\n				<li class="foot-li"><a href="//yahoo.uservoice.com/forums/211185-us-flickr">',a={hash:{intlName:"common.FEEDBACK"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+'</a></li>\n				<li class="foot-li"><a href="/abuse">',a={hash:{intlName:"common.REPORT_ABUSE"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+'</a></li>\n				<li class="foot-li"><a href="/help/forum">',a={hash:{intlName:"common.HELP_FORUM"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+'</a></li>\n\n				<li class="foot-li lang-switcher">\n					<a href="/change_language.gne?lang='+l((o=(o=t.selectedLang,o==null||o===!1?o:o.code),typeof o===f?o.apply(t):o))+"&csrf="+l((o=(o=t.selectedLang,o==null||o===!1?o:o.csrf),typeof o===f?o.apply(t):o))+'">'+l((o=(o=t.selectedLang,o==null||o===!1?o:o.name),typeof o===f?o.apply(t):o))+'</a>\n					<span class="arrow"></span>\n				</li>\n			</ul>\n		</div>\n		<div class="foot-bottom-row">\n			<div class="foot-yahoo">\n				<ul class="foot-nav-ul">\n					<li class="foot-li"><a href="//info.yahoo.com/privacy/us/yahoo/flickr/details.html">',a={hash:{intlName:"common.PRIVACY"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+'</a></li>\n					<li class="foot-li"><a href="/help/terms">',a={hash:{intlName:"common.TERMS"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+'</a></li>\n					<li class="foot-li"><a href="//safely.yahoo.com">',a={hash:{intlName:"common.YAHOO_SAFELY"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+'</a></li>\n					<li class="foot-li"><a href="//help.yahoo.com/kb/flickr">',a={hash:{intlName:"common.HELP"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+'</a></li>\n				</ul>\n			</div>\n\n			<div class="foot-company">\n				',a={hash:{intlName:"common.A_YAHOO_COMPANY_WITH_LINK"},data:i},s+=l((o=n.intlHTMLMessage||t.intlHTMLMessage,o?o.call(t,a):c.call(t,"intlHTMLMessage",a)))+'\n			</div>\n\n			<div class="foot-social">\n				<ul class="foot-nav-ul">\n					<li><a target="_blank" href="http://flickr.tumblr.com/">\n						<svg class="ft-icon ft-tumblr"><use xlink:href="#icon-tumblr"></use></svg>\n					</a></li>\n					<li><a target="_blank" href="https://www.facebook.com/flickr">\n						<svg class="ft-icon ft-facebook"><use xlink:href="#icon-facebook"></use></svg>\n					</a></li>\n					<li><a target="_blank" href="https://twitter.com/flickr">\n						<svg class="ft-icon ft-twitter"><use xlink:href="#icon-twitter"></use></svg>\n					</a></li>\n					<li><a target="_blank" href="https://plus.google.com/+flickr">\n						<svg class="ft-icon ft-googleplus"><use xlink:href="#icon-google"></use></svg>\n					</a></li>\n				</ul>\n			</div>\n		</div>\n	</div>\n</div>\n\n',a={hash:{},inverse:h.noop,fn:h.program(5,v,i),data:i},u=(o=n.isFlipped||t.isFlipped,o?o.call(t,t.flippers,"enable-darla-beacon",a):c.call(t,"isFlipped",t.flippers,"enable-darla-beacon",a));if(u||u===0)s+=u;return s+="\n",s}),r={};e.Array.each(["darla-script-setup"],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/footer-full",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-darla-script-setup"]});
YUI.add("footer-full-view",function(e){var t=["en-US","zh-HK","de-DE","es-US","fr-FR","ko-KR","it-IT","pt-BR","vn-VN","id-ID"],n={"en-US":"English","de-DE":"Deutsch","es-US":"Espa\u00f1ol","fr-FR":"Fran\u00e7ais","ko-KR":"\ud55c\uae00","it-IT":"Italiano","pt-BR":"Portugu\u00eas","vn-VN":"Ti\u1ebfng Vi\u1ec7t","id-ID":"Bahasa Indonesia","zh-HK":"\u7e41\u9ad4\u4e2d\u6587"};e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.get("container").get("innerHTML")===""&&this.setContainerHTML('<div class="footer-full-content"></div>'),this.appStateParams=e,this.set("hideOptOutBanner",e.hideOptOutBanner),this.set("showOptOutBanner",e.showOptOutBanner),this.set("hideMobileBanner",e.hideMobileBanner),this},subviewConfig:{},loadState:function(){var r,i,s;s=this.appContext.auth&&this.appContext.auth.csrf?this.appContext.auth.csrf:"",this.lang=this.appContext.lang,this.menuLangs=[],this.lang==="zh-Hant-HK"&&(this.lang="zh-HK"),this.lang.toLowerCase()==="vi-vn"&&(this.lang="vn-VN"),this.selectedLang={code:this.lang,name:n[this.lang],csrf:s};for(r=0,i=t.length;r<i;r++){if(t[r]===this.lang)continue;typeof t[r]=="string"&&this.menuLangs.push({code:t[r].toLowerCase(),name:n[t[r]],csrf:s})}return e.Promise.resolve()},buildContainer:function(){var t={},n={},r=this.appContext.flipper.toJSON();return this.get("viewer")&&(t=e.merge(this.get("viewer").toJSON(),{urls:e.URLHelper.generatePersonUrls(this.get("viewer"))})),n={flippers:r,displayLangs:this.displayLangs,selectedLang:this.selectedLang,menuLangs:this.menuLangs},YUI.Env.isServer?n.pageUrl=this.appContext.request.url:n.pageUrl=window.location.pathname,this.appContext.getCookie("mobile_allow_www")&&!this.appStateParams.hideMobileBanner?n.isOptedOutOfMobile=!this.get("hideMobileBanner"):!this.appContext.getCookie("mobile_allow_www")&&this.get("hideMobileBanner")&&(n.hasNoOptOut=!0),this.setContainerHTML(this.templates("footer-full")(n)),this},activate:function(){var t=this.get("container"),n=t.one(".lang-switcher"),r=n.one("a"),i=t.one(".foot-mobile-banner a"),s=t.one(".opt-out-www");return this.menuLangsFormatted=this.menuLangs.map(function(e){return{href:"/change_language.gne?lang="+e.code+"&csrf="+e.csrf,text:e.name}}),this.registerEventHandler(n.on("click",function(t){t.preventDefault(),r.addClass("dimmed");var i=new e.Views.FluidDroparound({anchorOffsetHorizontal:n.get("offsetWidth"),appContext:this.appContext,showDropArrow:!0,observePageResize:!0,dismissOnOverlayClick:!0,anchorElement:n.one(".arrow"),classList:["lang-droparound"],menuItems:this.menuLangsFormatted});i.show(),this.registerEventHandler(i.on("closeDroparound",function(e){r.removeClass("dimmed")}),this)},this)),i&&this.registerEventHandler(i.on("click",function(e){this.appContext.removeCookie({cookieName:"mobile_allow_www",path:"/"})},this)),s&&this.registerEventHandler(s.on("click",function(e){this.appContext.setCookie({cookieName:"mobile_allow_www",path:"/",cookieValue:1})},this)),this}})},"@VERSION@",{requires:["flickr-view","hermes-template-footer-full","footer-full-css","url-helper","flickrui-css","flickrui-dialogs-css","dropdown","fluid-droparound-view"],langBundles:["common"]});
YUI.add("hermes-template-mobile-photo-well",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function l(e,t){var r="",i;r+='\n	<a class="main-image-wrapper" href="',(i=n.videoURL)?i=i.call(e,{hash:{},data:t}):(i=e.videoURL,i=typeof i===u?i.apply(e):i),r+=a(i)+'" ',i=n["if"].call(e,e.isServer,{hash:{},inverse:f.noop,fn:f.program(2,c,t),data:t});if(i||i===0)r+=i;r+='>\n		<div class="play-wrapper">\n			<svg class="icon icon-play"><use xlink:href="#icon-play"></use></svg>\n		</div>\n\n		<img class="main-image" style="',i=n["if"].call(e,e.isServer,{hash:{},inverse:f.noop,fn:f.program(4,h,t),data:t});if(i||i===0)r+=i;return r+=" max-width: 100%; max-height: ",(i=n.maxHeight)?i=i.call(e,{hash:{},data:t}):(i=e.maxHeight,i=typeof i===u?i.apply(e):i),r+=a(i)+'px;" src="',(i=n.url)?i=i.call(e,{hash:{},data:t}):(i=e.url,i=typeof i===u?i.apply(e):i),r+=a(i)+'" onload="registerFirstPhoto(this)" />\n	</a>\n',r}function c(e,t){var r="",i;return r+=' style="max-height: ',(i=n.loadHeight)?i=i.call(e,{hash:{},data:t}):(i=e.loadHeight,i=typeof i===u?i.apply(e):i),r+=a(i)+'px;"',r}function h(e,t){return"width: 100%; "}function p(e,t){var r="",i;r+='\n	<div class="main-image-wrapper" ',i=n["if"].call(e,e.isServer,{hash:{},inverse:f.noop,fn:f.program(7,d,t),data:t});if(i||i===0)r+=i;r+='>\n		<img class="main-image img" style="',i=n["if"].call(e,e.isServer,{hash:{},inverse:f.noop,fn:f.program(4,h,t),data:t});if(i||i===0)r+=i;return r+=' max-width: 100%;" src="',(i=n.url)?i=i.call(e,{hash:{},data:t}):(i=e.url,i=typeof i===u?i.apply(e):i),r+=a(i)+'" onload="registerFirstPhoto(this)"/>\n	</div>\n	<div class="main-image-wrapper-underlay"></div>\n	<script>\n	var windowWidth = window.innerWidth;\n	var aspect = ',(i=n.loadAspect)?i=i.call(e,{hash:{},data:t}):(i=e.loadAspect,i=typeof i===u?i.apply(e):i),r+=a(i)+";\n\n	if (aspect) {\n		document.getElementsByClassName('main-image')[0].style.height = (windowWidth * aspect) + 'px';\n	}\n	</script>\n",r}function d(e,t){var r="",i;return r+='style="max-height: ',(i=n.loadHeight)?i=i.call(e,{hash:{},data:t}):(i=e.loadHeight,i=typeof i===u?i.apply(e):i),r+=a(i)+'px;"',r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='\n<a class="loading hide-nav-link prev-photo photo-link" href="#">\n	<div class="arrow-overlay arrow-left">\n		<svg class="tiny icon icon-nav_left prev-photo-icon"><use xlink:href="#icon-nav_left"></use></svg>\n	</div>\n</a>\n\n',o=n["if"].call(t,t.isVideo,{hash:{},inverse:f.program(6,p,i),fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+='\n\n\n<a class="loading hide-nav-link next-photo photo-link" href="#">\n	<div class="arrow-overlay arrow-right">\n		<svg class="tiny icon icon-nav_right next-photo-icon"><use xlink:href="#icon-nav_right"></use></svg>\n	</div>\n</a>\n',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/mobile-photo-well",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("matrix-math",function(e){e.MatrixMath={iterate:function(t,n,r,i){var s=[],o=t.length,u=t[0].length,a,f;for(a=0;a<o;a++){s[a]=[];if(u)for(f=0;f<u;f++)e.Lang.isArray(n)?s[a][f]=r.call(i,t[a][f],n[a][f]):s[a][f]=r.call(i,t[a][f],n);else e.Lang.isArray(n)?s[a]=r.call(i,t[a],n[a]):s[a]=r.call(i,t[a],n)}return s},add:function(e,t){return this.iterate(e,t,function(e,t){return e+t},this)},subtract:function(e,t){return this.iterate(e,t,function(e,t){return e-t},this)},divide:function(e,t){return this.iterate(e,t,function(e,t){return e/t})},multiply:function(e,t){return this.iterate(e,t,function(e,t){return e*t})},realMultiply:function(e,t){var n=[],r=e.length,i=e[0].length,s,o,u;for(s=0;s<r;s++){n[s]=[];for(o=0;o<i;o++)for(u=0;u<i;u++)n[s][o]+=e[s][u]*t[s][o]}return n},equality:function(e,t){var n=!0;if(e.length!==t.length)return!1;try{this.iterate(e,t,function(e,t){if(e!==t)return n=!1,0})}catch(r){n=!1}return n}}},"@VERSION@",{requires:[],optional:[]});
YUI.add("mrpinchy",function(e){function r(e){var t=e.length,n=0,r=0,i=0;for(i=0;i<t;i++)r+=e[i].pageY,n+=e[i].pageX;return[n/t,r/t]}function i(i){function _(t){E++,T&&T.cancel(),Date.now()-x>180?(E=1,T=e.later(200,this,function(){L.fire("mrpinchy:singletap",t)})):E===2&&(D(),E=0,L.fire("mrpinchy:doubletap"),L.fire("mrpinchy:reset")),x=Date.now()}function D(){s&&(s.setStyles({"-webkit-transition":"-webkit-"+O,"-moz-transition":"-moz-"+O,"-o-transition":"-o-"+O,"-ms-transition":"-ms-"+O,transition:O}),V([[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,1,1]],!0),s.setStyle("transform",M)),y=1,d=1}function H(e,t){var n=X(),r;t?r=e:r=y*e,n[0][0]=r,n[1][1]=r,V(n,!0),d=r}function B(e,t,r){var i,s,a,f,l,p,v,m=y*e;i=R(),s=[t[0]-i[0],t[1]-i[1]],a=[c,h],f=n.multiply(a,d),l=n.multiply(a,m),p=n.subtract(l,f),v=n.multiply(n.divide(s,l),p),U([v[0],-v[1]],!0),H(e);if(m>o&&!C||m<u&&!C)C={scale:e,translate:[X()[3][0],X()[3][1]]}}function j(e){if(e.touches&&e.touches.length>1){var t=Math.abs(e.touches[0].pageX-e.touches[1].pageX),n=Math.abs(e.touches[0].pageY-e.touches[1].pageY),r=Math.sqrt(t*t+n*n)/S;return r}return 1}function F(e){if(e.touches.length===2){m||L.fire("mrpinchy:startpinch"),m=1;var t=e.scale;t||(t=j(e)),B(t,r(e.touches))}}function I(e){var t,r,i,s,o,u={top:0,right:0,bottom:0,left:0},a={top:0,right:0,bottom:0,left:0};if(!v)return;var f=g[0]-v[0],l=g[1]-v[1];N&&(t=R(),i=[c,h],r=n.multiply(i,d),s=n.add(t,r),o=n.divide(r,2),o=n.add(o,t),t[1]<N[0][1]&&(a.top=1),t[0]<N[0][0]&&(a.left=1),s[0]>N[1][0]&&(a.right=1),s[1]>N[1][1]&&(a.bottom=1));var m=X();if(a.left||a.right||!N){var y=parseInt(m[3][0],10)+Math.round(f);y&&(m[3][0]=y)}if(a.bottom||a.top||!N)m[3][1]=parseInt(m[3][1],10)+Math.round(l);V(m),v=g,k=null,t[1]>N[0][1]&&a.bottom&&(u.bottom=1),s[1]<N[1][1]&&a.top&&(u.top=1),t[0]>N[0][0]&&a.right&&(u.right=1),s[0]<N[1][0]&&a.left&&(u.left=1),u.bottom&&u.right?k=n.subtract(N[0],p):u.bottom&&u.left?k=n.subtract([N[1][0],N[0][1]],[Math.round((p[0]+c)*d),p[1]]):u.top&&u.right?k=[N[0][0]-p[0],N[1][1]-(p[1]+r[1])]:u.top&&u.left?k=[N[1][0]-(p[0]+r[0]),N[1][1]-(p[1]+r[1])]:u.right?k=[N[0][0]-p[0],parseInt(m[3][1],10)+Math.round(l)]:u.left?k=[Math.round(N[1][0]-p[0]-r[0]),parseInt(m[3][1],10)+Math.round(l)]:u.bottom?k=[parseInt(m[3][0],10)+Math.round(f),Math.round(N[0][1]-p[1])]:u.top&&(k=[parseInt(m[3][0],10)+Math.round(f),N[1][1]-(p[1]+r[1])])}function q(e){w||(e.preventDefault(),P[e.type](e))}function R(){return s.getXY()}function U(e,t){var n=X();t?(n[3][0]-=e[0],n[3][1]+=e[1]):(n[3][0]=e[0],n[3][1]=e[1]),V(n)}function z(){var e=X(),t=[];t.push([e[0][0],e[0][1]]),t.push([e[1][0],e[1][1]]),t.push([e[3][0],e[3][1]]),s&&s.setStyle("transform","matrix( "+t.join(",")+")")}function W(){var e=X();V(e)}function X(){var e,n=[],r=[],i;if(a)return a;i=s.getStyle("transform");if(!i.match(t))return V([[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,1,1]],!0),a;e=i.match(t)[1],r=e.replace(/\s/g,"").split(",");var o=0,u;for(var f=0;f<4;f++){u=[];for(var l=0;l<4;l++)u.push(r[o++]);n.push(u)}return a=n,n}function V(e,t){if(!e)return;if(e.length!==4)return;a=e,t&&$()}function $(){var e=a;e&&s&&s.setStyle("transform","matrix3d("+e.join(",")+")")}function J(){return q}function K(){s=null,w=!0}var s=i.node,o=i.maxScale||10,u=i.minScale||.5,a,f,l=s.one(".img"),c=l.get("offsetWidth"),h=l.get("offsetHeight"),p=l.getXY(),d=1,v=[0,0],m=0,g=[0,0],y=1,b=0,w=!1,E=0,S,x=0,T,N,C,k,L=new e.EventTarget,A,O="transform 0.25s ease-out",M=s.getStyle("transform");i.boundingBox?N=i.boundingBox:N=[[0,0],[window.innerWidth,window.innerHeight]],s&&s.setStyles({"-webkit-transform-origin":"0 0","-moz-transform-origin":"0 0","-o-transform-origin":"0 0","-ms-transform-origin":"0 0","transform-origin":"0 0"}),A=s,s&&s.on("webkitTransitionEnd",function(){A.setStyles({"-webkit-transition":"","-moz-transition":"","-o-transition":"","-ms-transition":"",transition:""})});var P={touchstart:function(e){W(),g=r(e.touches),v=g,f=g,e.touches.length===1?b=Date.now():b=0;if(e.touches.length===2){var t=Math.abs(e.touches[0].pageX-e.touches[1].pageX),n=Math.abs(e.touches[0].pageY-e.touches[1].pageY);S=Math.sqrt(t*t+n*n)}},touchmove:function(e){g=r(e.touches),!m&&e.touches.length===1?d!==1&&I(e):e.touches.length===2&&(b=0,F(e)),$()},touchend:function(e){e.touches.length<1&&d!==1?(y=d,b?(Date.now()-b<100&&(_(e),b=0),b=0,k&&(s.setStyles({"-webkit-transition":"-webkit-"+O,"-moz-transition":"-moz-"+O,"-o-transition":"-o-"+O,"-ms-transition":"-ms-"+O,transition:O}),U(k),$(),k=null),L.fire("mrpinchy:endmove")):y>o?(H(o,!0),U(C.translate),d=o,y=o,s.setStyles({"-webkit-transition":"-webkit-"+O,"-moz-transition":"-moz-"+O,"-o-transition":"-o-"+O,"-ms-transition":"-ms-"+O,transition:O}),$(),C=null):y<u&&(H(u,!0),U([0,0]),d=u,y=u,s.setStyles({"-webkit-transition":"-webkit-"+O,"-moz-transition":"-moz-"+O,"-o-transition":"-o-"+O,"-ms-transition":"-ms-"+O,transition:O}),$(),L.fire("mrpinchy:reset",y),D(),C=null),L.fire("mrpinchy:endpinch",y),m=0,z()):d===1&&L.fire("mrpinchy:endpinch",1)}};return L.getTouchHandler=J,L.destroy=K,L.updateBoundingBox=function(e){N=e},L.updateImageSize=function(){c=l.get("offsetWidth"),h=l.get("offsetHeight")},L.resetTransform=function(){D()},L}var t=/matrix3d\(([^\)]+)\)/,n=e.MatrixMath;e.MrPinchy={init:function(e){return new i(e)}}},"@VERSION@",{requires:["matrix-math"],optional:[]});
YUI.add("mobile-photo-well-view",function(e){var t=3,n="https://m.flickr.com/photos/{nsid}/{photoid}/play/",r=500,i=500;e.namespace("Views")[this.name]=e.Base.create("mobile-photo-well-view",e.FlickrView,[],{langBundles:["common"],initializer:function(t){this.photoId=t.photoId,this.context=e.clone(t.context,!0);var n=this.appContext.getUA().os;this.nsid=t.nsid,this.disablePinchZooming=n==="windows",this.isAndroid=n==="android";if(this.context&&this.context.params&&this.context.params.isSharedEntity){var r=this.context.params;this.appContext.setGPCredentials({gp_code:r.gpCode,gp_owner:r.gpOwner,share_code:r.gpCode})}else this.appContext.setGPCredentials(null);return this},loadState:function(){var t=this,n=[];return n.push(this.appContext.getModel("photo-models",this.photoId).then(function(e){t.set("photoModel",e)})),e.Promise.all(n)},buildContainer:function(){var s,o,u=this.get("photoModel").getValue("isVideo"),a,f,l,c;if(YUI.Env.isServer)s=r,o=i,a=s/8,f=o/8;else{s=parseInt(e.StorageHelper.getItem("mobile-photo-well-width"),10),o=parseInt(e.StorageHelper.getItem("mobile-photo-well-height"),10);var h=this.getUsableAreaSize(),p=h.actualW,d=h.adjustedH;if(!s||isNaN(s)||s<50)s=p;if(!o||isNaN(o)||o<50)o=d;a=s,f=o}var v=this.get("photoModel").getSizeToFit({width:a,height:f},{cropToFit:!0});return this.set("bestImageSize",v),l=Math.max(v.height/t,o),c=v.height/v.width,this.setContainerHTML(this.templates("mobile-photo-well")({maxHeight:l,isServer:YUI.Env.isServer,loadAspect:c,loadHeight:c*s,url:v.url,videoURL:n.replace("{nsid}",this.nsid).replace("{photoid}",this.photoId),isVideo:u})),this},activate:function(){var e=this.get("container"),t=e.one(".main-image"),n=e.one(".main-image-wrapper"),r=this.get("photoModel"),i=this.get("photoModel").getValue("isVideo"),s=this;e.all(".photo-link.loading").removeClass("loading"),t.setStyle("width",null),n.setStyle("height",null),this.findBestPhoto(r,t),this.appContext.getViewCounter().queue(this.get("photoModel").getValue("id"),this.appContext.getReferrer()),this.loadAdjacentPhotos();var o=parseInt(n.getComputedStyle("height"),10);return this.get("container").setStyle("height",o+"px"),n.setStyle("position","absolute"),!i&&!this.disablePinchZooming&&this.addPinchy(),window.orientation&&(window.onorientationchange=function(){var e=window.innerWidth,t=window.innerHeight,n=e>t,r=[[0,0],[n?t:e,n?e:t]];s.transform.updateBoundingBox(r),s.transform.updateImageSize()}),this.context&&this.context.modelName&&this.context.params&&this.appContext.getModel(this.context.modelName,this.context.params).then(function(e){if(e)return s.set("contextModel",e),e.getValue("photoContextList").getContext({photoId:s.photoId}).then(function(){var t=-1,n=e.getValue("photoContextList").getList();n.some(function(e,n){return e.id===s.photoId&&(t=n),t>0});if(t>-1){var r,i,o,u,a="/in/"+e.getValue("urlSuffix");t>0&&(r=n[t-1],r&&(o=r.getValue("url")+a)),t<n.length-1&&(i=n[t+1],i&&(u=i.getValue("url")+a)),o&&s.get("container").one(".prev-photo").setAttribute("href",o).removeClass("hide-nav-link"),u&&s.get("container").one(".next-photo").setAttribute("href",u).removeClass("hide-nav-link")}})}),this},addPinchy:function(){var n=window.innerWidth,r=window.innerHeight,i=n>r,s=this.get("container").one(".main-image-wrapper"),o=this.get("container").one(".main-image-wrapper-underlay"),u=[[0,0],[i?r:n,i?n:r]],a=this,f;this.transform=e.MrPinchy.init({node:s,maxScale:i?2:t,minScale:1,boundingBox:u}),f=this.transform.getTouchHandler(),this.largeLoaded=!1,s.on("touchstart",function(t){f(t),a.largeLoaded||(a.largeLoaded=!0,a.findBestPhoto(a.get("photoModel"),s.one(".img"),!0,!0)),a.addZoomTimeout=setTimeout(function(){a.get("container").addClass("zoomed"),s.addClass("zoomed"),e.one("html").setStyle("position","fixed"),o.setStyle("display","block"),setTimeout(function(){o.addClass("show-overlay")},10)},200)}),s.on("touchmove",function(e){f(e)}),s.on("touchend",function(e){f(e)}),s.on("touchcancel",function(e){a.transform.resetTransform(),a.transform.fire("mrpinchy:reset")}),this.transform.on("mrpinchy:reset",function(){clearTimeout(a.addZoomTimeout),a.get("container").removeClass("zoomed"),s.removeClass("zoomed"),e.one("html").setStyle("position",null),o.removeClass("show-overlay"),setTimeout(function(){o.setStyle("display","none")},800)}),this.transform.on("mrpinchy:endpinch",function(t){t===1&&(clearTimeout(a.addZoomTimeout),a.get("container").removeClass("zoomed"),s.removeClass("zoomed"),e.one("html").setStyle("position",null),o.removeClass("show-overlay"),setTimeout(function(){o.setStyle("display","none")},800))})},getUsableAreaSize:function(){var e=window.innerWidth,t=window.innerHeight,n=t-50-50;return this.get("container").ancestor(".show-upsell-banner")&&(n-=50),{actualW:e,actualH:t,adjustedH:n}},findBestPhoto:function(n,r,i,s){var o=this.getUsableAreaSize(),u=o.actualW,a=o.adjustedH,f=n.getSizeToFit({width:i?u*t:u,height:i?a*t:a},{cropToFit:!0});a=Math.min(u/f.width*f.height,o.adjustedH);if(r)r.getAttribute("src")!==f.url&&r.setAttribute("src",f.url),this.set("bestImageSize",f),r.setStyle("height",a),this.get("container").setStyle("height",a),YUI.Env.isServer||(e.StorageHelper.setItem("mobile-photo-well-width",u),e.StorageHelper.setItem("mobile-photo-well-height",o.adjustedH));else{var l=new Image;l.src=f.url}},loadAdjacentPhotos:function(){var e=this.get("prevPhoto"),t=this.get("nextPhoto");t&&this.findBestPhoto(t),e&&this.findBestPhoto(e)}},{ATTRS:{}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-mobile-photo-well","viewport-data","storage-helper","mrpinchy"],langBundles:["common"]});
YUI.add("hermes-template-mobile-photo-engagement",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function h(e,t){var r="",i,s,o;r+='\n			<span class="fave-count-label" style="margin-left: ',(i=n.faveSvgMargin)?i=i.call(e,{hash:{},data:t}):(i=e.faveSvgMargin,i=typeof i===a?i.apply(e):i),r+=f(i)+'px">\n				',s=n["if"].call(e,(i=e.engagement,i==null||i===!1?i:i.isFaved),{hash:{},inverse:l.program(4,d,t),fn:l.program(2,p,t),data:t});if(s||s===0)r+=s;return r+="\n				",o={hash:{},data:t},r+=f((i=n.friendlyNumber||e.friendlyNumber,i?i.call(e,(i=e.engagement,i==null||i===!1?i:i.faveCount),o):c.call(e,"friendlyNumber",(i=e.engagement,i==null||i===!1?i:i.faveCount),o)))+"\n			</span>\n		",r}function p(e,t){return'\n					<svg class="icon icon-fave"><use xlink:href="#icon-fave"></use></svg>\n				'}function d(e,t){return'\n					<svg class="icon icon-fave_hollow"><use xlink:href="#icon-fave_hollow"></use></svg>\n				'}function v(e,t){var r="",i;return r+='\n			<span class="fave-count-label" style="margin-left: ',(i=n.faveSvgMargin)?i=i.call(e,{hash:{},data:t}):(i=e.faveSvgMargin,i=typeof i===a?i.apply(e):i),r+=f(i)+'px">\n				<svg class="icon icon-fave_hollow"><use xlink:href="#icon-fave_hollow"></use></svg>\n				0\n			</span>\n		',r}function m(e,t){var r="",i,s;return r+='\n			<span class="comment-count-label" style="margin-left: ',(i=n.commentSvgMargin)?i=i.call(e,{hash:{},data:t}):(i=e.commentSvgMargin,i=typeof i===a?i.apply(e):i),r+=f(i)+'px">\n				<svg class="icon icon-comment_hollow"><use xlink:href="#icon-comment_hollow"></use></svg>\n				',s={hash:{},data:t},r+=f((i=n.friendlyNumber||e.friendlyNumber,i?i.call(e,(i=e.engagement,i==null||i===!1?i:i.commentCount),s):c.call(e,"friendlyNumber",(i=e.engagement,i==null||i===!1?i:i.commentCount),s)))+"\n			</span>\n		",r}function g(e,t){var r="",i;return r+='\n			<span class="comment-count-label" style="margin-left: ',(i=n.commentSvgMargin)?i=i.call(e,{hash:{},data:t}):(i=e.commentSvgMargin,i=typeof i===a?i.apply(e):i),r+=f(i)+'px">\n				<svg class="icon icon-comment_hollow"><use xlink:href="#icon-comment_hollow"></use></svg>\n			0</span>\n		',r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=this,c=n.helperMissing;s+='<div class="actions-container">\n	<div class="fave-count">\n		',u=n["if"].call(t,(o=t.engagement,o==null||o===!1?o:o.faveCount),{hash:{},inverse:l.program(6,v,i),fn:l.program(1,h,i),data:i});if(u||u===0)s+=u;s+='\n	</div>\n\n	<div class="comment-count">\n		',u=n["if"].call(t,(o=t.engagement,o==null||o===!1?o:o.commentCount),{hash:{},inverse:l.program(10,g,i),fn:l.program(8,m,i),data:i});if(u||u===0)s+=u;return s+='\n	</div>\n\n	<div class="share-container">\n		<span class="share-container-icon">\n			<svg class="icon icon-share_hollow"><use xlink:href="#icon-share_hollow"></use></svg>\n		</span>\n	</div>\n</div>',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/mobile-photo-engagement",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-mobile-share-modal",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function";return s+='<div class="share">\n	<p>',a={hash:{intlName:"share-modal.SHARE"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):f.call(t,"intlMessage",a)))+'</p>\n\n	<form>\n		<input type="text" value="',(u=n.shortUrl)?u=u.call(t,{hash:{},data:i}):(u=t.shortUrl,u=typeof u===c?u.apply(t):u),s+=l(u)+'" readonly>\n	</form>\n</div>',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/mobile-share-modal",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("mobile-photo-engagement-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.photoId=e.photoId,this.isOwner=e.isOwner,this.nsid=e.nsid,this},loadState:function(){var t=this,n={};return n.photoEngagement=this.appContext.getModel("photo-engagement-models",this.photoId),n.photo=this.appContext.getModel("photo-models",this.photoId),this.isOwner&&(n.personModel=this.appContext.getModel("person-models",this.nsid)),(new e.FlickrPromise(n)).then(function(e){t.set("photo-engagement",e.photoEngagement),t.set("photo",e.photo)},function(t){e.Flog.error("[mobile-photo-engagement-view] Error loadState: ",t)})},buildContainer:function(){var e=this.get("photo-engagement"),t=e.toJSON(),n,r=!1,i=25,s=25;return t.commentCount>100&&(s=45),t.faveCount>100&&(i=45),this.isOwner&&this.appContext.flipper.isFlipped("rebootify-stats")&&this.isPro&&this.dailyViewsModel.getValue("totals").views>0&&(r=!0),n=this.templates("mobile-photo-engagement")({engagement:e.toJSON(),isMobileStats:this.isMobileStats,commentSvgMargin:s,faveSvgMargin:i,showMoreStatsLink:r}),this.setContainerHTML(n),this},activate:function(){var t=this.get("photo-engagement"),n=this.get("container"),r=this;return this.registerEventHandler(n.delegate("click",this.onFaveClick.bind(this),".fave-count")),this.registerEventHandler(n.delegate("click",this.onShareClick.bind(this),".share-container")),this.registerEventHandler(n.delegate("click",this.onCommentClick.bind(this),".comment-count")),t&&this.registerEventHandler(t.on("valuesChanged",function(n){var i,s=typeof n.faveCount!="undefined"||typeof n.isFaved!="undefined"||typeof n.canFave!="undefined";if(!s){typeof n["commentCount"]!="undefined"&&r.buildContainer();return}r.processingFave=!0,r.buildContainer(),i=t.remoteUpdate(),i.then(function(){r.processingFave=!1},function(i){if(i.code!==3){i.code!==5&&e.Object.each(n,function(e,n){t.setValue(n,e.prevVal)});var s=e.Views.dialog.getInstance("dialog-alert",{content:r.intlMessage({intlName:"fave-view.COULDNT_FAVE"}),attrs:{title:r.intlMessage({intlName:"common.ERROR"}),level:"warning",confirmLabel:r.intlMessage({intlName:"common.OK"})},appContext:r.appContext,dialogClass:"scrappy-dialog"});s.show()}r.processingFave=!1}).then(null,function(e){r.processingFave=!1})},r.photoId)),this},onFaveClick:function(t,n){var r=this,i=this.get("photo-engagement"),s=this.appContext.getUA().os,o=this.appContext.getUA().isWebview,u="photos/"+this.nsid+"/"+this.photoId;t.preventDefault();if(this.processingFave)return;this.processingFave=!0,this.appContext.getViewer().signedIn?i.getValue("canFave")&&(i.registry.toggleFave(this.photoId),e.rapidTracker.beacon(this.name,"faveStarActionBarButtonClick")):(e.use("mobile-actions-helper",function(e){e.MobileActionsHelper.redirectToAppOrStore({os:s,isWebview:o,pageURL:u,beacon:{name:"mpp_fave_signedout",section:"mpp_fave"},viewName:r.name})}),this.processingFave=!1)},onShareClick:function(){var t=new e.Views.FluidDroparound({appContext:this.appContext,preferLeft:!0,anchorOffsetVertical:10,anchorOffsetHorizontal:225,showDropArrow:!0,observePageResize:!0,anchorElement:this.get("container").one(".share-container svg"),htmlMessage:this.templates("mobile-share-modal")({shortUrl:e.URLHelper.getShortURL(this.photoId)})});this.registerEventHandler(t.on("activated",function(){var e=t.get("container").one("input")._node;e&&(e.focus(),setTimeout(function(){e.setSelectionRange(0,999)},0))},this)),t.show()},onCommentClick:function(){var t=e.one(".new-comment-text"),n=50,r=this,i=this.appContext.getUA().os,s=this.appContext.getUA().isWebview,o="photos/"+this.nsid+"/"+this.photoId;this.get("container").ancestor(".show-upsell-banner")&&(n=120),this.appContext.getViewer().signedIn?t&&(e.config.win.scrollTo(t.getX(),t.getY()-n),t.focus()):e.use("mobile-actions-helper",function(e){e.MobileActionsHelper.redirectToAppOrStore({os:i,isWebview:s,pageURL:o,beacon:{name:"mpp_comment_signedout",section:"mpp_comment"},viewName:r.name})})}})},"@VERSION@",{requires:["flickr-view","flickrui-css","hermes-template-mobile-photo-engagement","hermes-template-mobile-share-modal","photo-sidebar-actions-css","fluid-modal-view","fluid-droparound-view","stats-photo-view","stats-helper","url-helper"],optional:["photo-engagement-models"],langBundles:["common","photo-page-scrappy","fave-view","settings","info-charm","share-modal"]});
YUI.add("hermes-lang-info-charm",function(e,t){e.Intl.add("hermes/info-charm","en-US",{CHANGE_PRIVACY_ERROR:["There was a problem changing your photo's privacy"],CHANGE_LICENSE_ERROR:["There was a problem changing your photo's license"],CHANGE_SAFETLY_ERROR:["There was a problem changing your photo's safety level"],PUBLIC_PHOTO:["This photo is public"],FRIENDS_AND_FAMILY_PHOTO:["This photo is visible by friends and family"],FRIENDS_PHOTO:["This photo is visible by friends"],FAMILY_PHOTO:["This photo is visible by family"],PRIVATE_PHOTO:["This photo is private"],PUBLIC:["Public"],"FRIENDS AND FAMILY":["Friends & Family"],FAMILY:["Family"],FRIENDS:["Friends"],PRIVATE:["Private"]})},"@VERSION@",{requires:["intl"]});
YUI.add("mobile-photo-page-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.photoId=e.photoId,this.nsid=e.nsid,this.shouldDeferSubviews=!0,this},subviewConfig:{"global-nav-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,enableMobileNav:!0},"mobile-attribution-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,additionalViewClasses:["clear-float","mobile-photopage-attribution"]},"sub-photo-title-desc-view":{requiredToShowOnClient:!0,isMobile:!0,requiredToShowOnServer:!0},"mobile-photo-engagement-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"mobile-sub-photo-stats-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"mobile-photo-well-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"sub-photo-comments-view":{isOnMobile:!0,canDefer:!0},"photo-charm-exif-scrappy-view":{isMobileExif:!0,additionalViewClasses:["light-background-view"],canDefer:!0},"mobile-sub-photo-license-privacy-view":{additionalViewClasses:["light-background-view"],canDefer:!0},"sub-photo-tags-tag-view":{isMobileTags:!0,additionalViewClasses:["light-background-view"],canDefer:!0},"footer-full-view":{hideMobileBanner:!0,canDefer:!0}},loadState:function(){return e.Promise.resolve()},buildContainer:function(){var e={"global-nav-view":this.subviews["global-nav-view"].get("container"),"mobile-photo-well-view":this.subviews["mobile-photo-well-view"].get("container"),"mobile-attribution-view":this.subviews["mobile-attribution-view"].get("container"),"sub-photo-title-desc-view":this.subviews["sub-photo-title-desc-view"].get("container"),"mobile-photo-engagement-view":this.subviews["mobile-photo-engagement-view"].get("container"),"mobile-sub-photo-stats-view":this.subviews["mobile-sub-photo-stats-view"].get("container"),"sub-photo-comments-view":this.subviews["sub-photo-comments-view"].get("container"),"photo-charm-exif-scrappy-view":this.subviews["photo-charm-exif-scrappy-view"].get("container"),"mobile-sub-photo-license-privacy-view":this.subviews["mobile-sub-photo-license-privacy-view"].get("container"),"sub-photo-tags-tag-view":this.subviews["sub-photo-tags-tag-view"].get("container"),"footer-full-view":this.subviews["footer-full-view"].get("container")};return this.setContainerHTML(this.templates("mobile-photo-page")(e)),this},buildHeadContainer:function(){var e=this.templates("head-meta")({isName:!0,metaName:"viewport",metaValue:"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"});this.set("headContainer",e),YUI.Env.isServer||this.updateHead()},activate:function(){return e.FastClick&&e.FastClick.attach(document.body),this},onSubviewEvent:function(e,t){t&&t[0]==="noTags"&&this.get("container").addClass("no-tags")},getTrackingSegments:function(){return{vwrOwner:this.isOwner?1:0}}},{ATTRS:{spaceid:{value:954010555}}}),e.Base.plug(e.Views[this.name],e.Plugin.FlickrView.TTFPRecorderPlugin,{selector:".main-image"})},"@VERSION@",{requires:["flutil","flickr-view","flickr-promise","hermes-template-head-meta","hermes-template-mobile-photo-page","attribution-view","footer-full-view","mobile-photo-well-view","mobile-photo-engagement-view","flickr-view","flog","global-nav-view","url","browser-support","mobile-photo-page-css","ttfp-recorder-plugin"],langBundles:[],optionalRequires:["fastclick"]});
YUI.add("fastclick",function(e,t){(function(){"use strict";function e(t,r){function s(e,t){return function(){return e.apply(t,arguments)}}var i;r=r||{},this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=r.touchBoundary||10,this.layer=t,this.tapDelay=r.tapDelay||200,this.tapTimeout=r.tapTimeout||700;if(e.notNeeded(t))return;var o=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"],u=this;for(var a=0,f=o.length;a<f;a++)u[o[a]]=s(u[o[a]],u);n&&(t.addEventListener("mouseover",this.onMouse,!0),t.addEventListener("mousedown",this.onMouse,!0),t.addEventListener("mouseup",this.onMouse,!0)),t.addEventListener("click",this.onClick,!0),t.addEventListener("touchstart",this.onTouchStart,!1),t.addEventListener("touchmove",this.onTouchMove,!1),t.addEventListener("touchend",this.onTouchEnd,!1),t.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(t.removeEventListener=function(e,n,r){var i=Node.prototype.removeEventListener;e==="click"?i.call(t,e,n.hijacked||n,r):i.call(t,e,n,r)},t.addEventListener=function(e,n,r){var i=Node.prototype.addEventListener;e==="click"?i.call(t,e,n.hijacked||(n.hijacked=function(e){e.propagationStopped||n(e)}),r):i.call(t,e,n,r)}),typeof t.onclick=="function"&&(i=t.onclick,t.addEventListener("click",function(e){i(e)},!1),t.onclick=null)}var t=navigator.userAgent.indexOf("Windows Phone")>=0,n=navigator.userAgent.indexOf("Android")>0&&!t,r=/iP(ad|hone|od)/.test(navigator.userAgent)&&!t,i=r&&/OS 4_\d(_\d)?/.test(navigator.userAgent),s=r&&/OS [6-7]_\d/.test(navigator.userAgent),o=navigator.userAgent.indexOf("BB10")>0;e.prototype.needsClick=function(e){switch(e.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(e.disabled)return!0;break;case"input":if(r&&e.type==="file"||e.disabled)return!0;break;case"label":case"iframe":case"video":return!0}return/\bneedsclick\b/.test(e.className)},e.prototype.needsFocus=function(e){switch(e.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!n;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!e.disabled&&!e.readOnly;default:return/\bneedsfocus\b/.test(e.className)}},e.prototype.sendClick=function(e,t){var n,r;document.activeElement&&document.activeElement!==e&&document.activeElement.blur(),r=t.changedTouches[0],n=document.createEvent("MouseEvents"),n.initMouseEvent(this.determineEventType(e),!0,!0,window,1,r.screenX,r.screenY,r.clientX,r.clientY,!1,!1,!1,!1,0,null),n.forwardedTouchEvent=!0,e.dispatchEvent(n)},e.prototype.determineEventType=function(e){return n&&e.tagName.toLowerCase()==="select"?"mousedown":"click"},e.prototype.focus=function(e){var t;r&&e.setSelectionRange&&e.type.indexOf("date")!==0&&e.type!=="time"&&e.type!=="month"?(t=e.value.length,e.setSelectionRange(t,t)):e.focus()},e.prototype.updateScrollParent=function(e){var t,n;t=e.fastClickScrollParent;if(!t||!t.contains(e)){n=e;do{if(n.scrollHeight>n.offsetHeight){t=n,e.fastClickScrollParent=n;break}n=n.parentElement}while(n)}t&&(t.fastClickLastScrollTop=t.scrollTop)},e.prototype.getTargetElementFromEventTarget=function(e){return e.nodeType===Node.TEXT_NODE?e.parentNode:e},e.prototype.onTouchStart=function(e){var t,n,s;if(e.targetTouches.length>1)return!0;t=this.getTargetElementFromEventTarget(e.target),n=e.targetTouches[0];if(r){s=window.getSelection();if(s.rangeCount&&!s.isCollapsed)return!0;if(!i){if(n.identifier&&n.identifier===this.lastTouchIdentifier)return e.preventDefault(),!1;this.lastTouchIdentifier=n.identifier,this.updateScrollParent(t)}}return this.trackingClick=!0,this.trackingClickStart=e.timeStamp,this.targetElement=t,this.touchStartX=n.pageX,this.touchStartY=n.pageY,e.timeStamp-this.lastClickTime<this.tapDelay&&e.preventDefault(),!0},e.prototype.touchHasMoved=function(e){var t=e.changedTouches[0],n=this.touchBoundary;return Math.abs(t.pageX-this.touchStartX)>n||Math.abs(t.pageY-this.touchStartY)>n?!0:!1},e.prototype.onTouchMove=function(e){if(!this.trackingClick)return!0;if(this.targetElement!==this.getTargetElementFromEventTarget(e.target)||this.touchHasMoved(e))this.trackingClick=!1,this.targetElement=null;return!0},e.prototype.findControl=function(e){return e.control!==undefined?e.control:e.htmlFor?document.getElementById(e.htmlFor):e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},e.prototype.onTouchEnd=function(e){var t,o,u,a,f,l=this.targetElement;if(!this.trackingClick)return!0;if(e.timeStamp-this.lastClickTime<this.tapDelay)return this.cancelNextClick=!0,!0;if(e.timeStamp-this.trackingClickStart>this.tapTimeout)return!0;this.cancelNextClick=!1,this.lastClickTime=e.timeStamp,o=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,s&&(f=e.changedTouches[0],l=document.elementFromPoint(f.pageX-window.pageXOffset,f.pageY-window.pageYOffset)||l,l.fastClickScrollParent=this.targetElement.fastClickScrollParent),u=l.tagName.toLowerCase();if(u==="label"){t=this.findControl(l);if(t){this.focus(l);if(n)return!1;l=t}}else if(this.needsFocus(l)){if(e.timeStamp-o>100||r&&window.top!==window&&u==="input")return this.targetElement=null,!1;this.focus(l),this.sendClick(l,e);if(!r||u!=="select")this.targetElement=null,e.preventDefault();return!1}if(r&&!i){a=l.fastClickScrollParent;if(a&&a.fastClickLastScrollTop!==a.scrollTop)return!0}return this.needsClick(l)||(e.preventDefault(),this.sendClick(l,e)),!1},e.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},e.prototype.onMouse=function(e){return this.targetElement?e.forwardedTouchEvent?!0:e.cancelable?!this.needsClick(this.targetElement)||this.cancelNextClick?(e.stopImmediatePropagation?e.stopImmediatePropagation():e.propagationStopped=!0,e.stopPropagation(),e.preventDefault(),!1):!0:!0:!0},e.prototype.onClick=function(e){var t;return this.trackingClick?
(this.targetElement=null,this.trackingClick=!1,!0):e.target.type==="submit"&&e.detail===0?!0:(t=this.onMouse(e),t||(this.targetElement=null),t)},e.prototype.destroy=function(){var e=this.layer;n&&(e.removeEventListener("mouseover",this.onMouse,!0),e.removeEventListener("mousedown",this.onMouse,!0),e.removeEventListener("mouseup",this.onMouse,!0)),e.removeEventListener("click",this.onClick,!0),e.removeEventListener("touchstart",this.onTouchStart,!1),e.removeEventListener("touchmove",this.onTouchMove,!1),e.removeEventListener("touchend",this.onTouchEnd,!1),e.removeEventListener("touchcancel",this.onTouchCancel,!1)},e.notNeeded=function(e){var t,r,i,s;if(typeof window.ontouchstart=="undefined")return!0;r=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1];if(r){if(!n)return!0;t=document.querySelector("meta[name=viewport]");if(t){if(t.content.indexOf("user-scalable=no")!==-1)return!0;if(r>31&&document.documentElement.scrollWidth<=window.outerWidth)return!0}}if(o){i=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/);if(i[1]>=10&&i[2]>=3){t=document.querySelector("meta[name=viewport]");if(t){if(t.content.indexOf("user-scalable=no")!==-1)return!0;if(document.documentElement.scrollWidth<=window.outerWidth)return!0}}}if(e.style.msTouchAction==="none"||e.style.touchAction==="manipulation")return!0;s=+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1];if(s>=27){t=document.querySelector("meta[name=viewport]");if(t&&(t.content.indexOf("user-scalable=no")!==-1||document.documentElement.scrollWidth<=window.outerWidth))return!0}return e.style.touchAction==="none"||e.style.touchAction==="manipulation"?!0:!1},e.attach=function(t,n){return new e(t,n)},typeof define=="function"&&typeof define.amd=="object"&&define.amd?define(function(){return e}):typeof module!="undefined"&&module.exports?(module.exports=e.attach,module.exports.FastClick=e):window.FastClick=e})(),
/*!
 Copyright (c) 2014 The Financial Times Ltd.

Permission is hereby granted, free of charge, to any person
obtaining a copy of this software and associated documentation
files (the "Software"), to deal in the Software without
restriction, including without limitation the rights to use,
copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the
Software is furnished to do so, subject to the following
conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
OTHER DEALINGS IN THE SOFTWARE.

*/
e.FastClick=window.FastClick},"@VERSION@",{affinity:"client"});
YUI.add("photo-well-view",function(e){var t=1,n=5;e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.photoId=t.photoId,this.contextData=e.clone(t.context,!0),this.isAd=!!t.ad,this.firstLoad=!!t.firstLoad,this.publisherUrl=t.publisherUrl,t.isFluid=!0,t.isOnDark=!0,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},subviewConfig:{"photo-well-media-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"photo-sidebar-toggle-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1},"attribution-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,additionalViewClasses:["is-real-fullscreen","photo-attribution"]},"photo-sidebar-actions-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,additionalViewClasses:["is-real-fullscreen"],disabled:function(){return this.appContext.experiments.fullscreen.disableRealFullscreenButtons()}},"people-notes-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:!0}},buildContainer:function(){var e=this,t,n="",r,i=0,s,o,u=".navigate-prev",a=".navigate-next",f,l,c,h;return this.firstLoad||(this.subviews["photo-sidebar-actions-view"]&&this.subviews["photo-sidebar-actions-view"].get("container").addClass("is-hidden"),this.subviews["photo-sidebar-toggle-view"]&&this.subviews["photo-sidebar-toggle-view"].get("container").addClass("is-hidden")),this.appContext.experiments.fullscreen.getMode()?this.subviews["attribution-view"]&&(YUI.Env.isServer||this.subviews["attribution-view"].get("container").removeClass("is-always-hidden"),!this.firstLoad&&this.contextData.modelName!=="photoList-models"&&this.contextData.modelName!=="explore-models"&&this.subviews["attribution-view"].get("container").addClass("is-hidden"),n=this.subviews["attribution-view"].get("container")):this.subviews["attribution-view"]&&(this.subviews["attribution-view"].get("container").addClass("is-always-hidden"),n=this.subviews["attribution-view"].get("container")),this.get("contextModel")&&(r=this.get("contextModel").getValue("photoContextList").getList(),r.length>2&&r.some(function(t){return i++,t.getValue("id")===e.photoId})&&(s=r.slice(i-2,i-1),o=r.slice(i,i+1),s&&s.length>0&&(f=e.setupNavLink(s[0],u,"previous"),s[0].getValue("owner")&&(s[0].getValue("title").trim()===""?c=e.intlMessage({intlName:"common.UNTITLED"}):c=s[0].getValue("title"),c+=" | "+e.intlMessage({intlName:"common.BY_USER",user:s[0].getValue("owner").getValue("username")}))),o&&o.length>0&&(l=e.setupNavLink(o[0],a,"next"),o[0].getValue("title").trim()===""?h=e.intlMessage({intlName:"common.UNTITLED"}):h=o[0].getValue("title"),h+=" | "+e.intlMessage({intlName:"common.BY_USER",user:o[0].getValue("owner").getValue("username")})))),t=this.templates("photo-well")({"photo-well-media-view":this.subviews["photo-well-media-view"].get("container"),"is-video":this.get("photo").getValue("isVideo"),"is-hidden":(YUI.Env.isServer||!this.firstLoad)&&!f&&!l,"prev-is-not-clickable":!f,"next-is-not-clickable":!l,"prev-url":f,"next-url":l,"prev-title":c,"next-title":h,"is-ad":this.isAd,"photo-sidebar-toggle-view":this.subviews["photo-sidebar-toggle-view"]?this.subviews["photo-sidebar-toggle-view"].get("container"):"","opt-out-enabled":this.appContext.experiments.optOut.enabled(),"photo-sidebar-actions-view":this.subviews["photo-sidebar-actions-view"]?this.subviews["photo-sidebar-actions-view"].get("container"):"","attribution-view":n,"people-notes-view":this.subviews["people-notes-view"]?this.subviews["people-notes-view"].get("container"):"",enableZoom:this.appContext.flipper.isFlipped("enable-scrappy-zoom")}),this.setContainerHTML(t),YUI.Env.isServer&&(this.serverWidth=this.subviews["photo-well-media-view"].serverWidth,this.serverHeight=this.subviews["photo-well-media-view"].serverHeight),this},loadState:function(){var t=this,n=[];return n.push(this.appContext.getModel("photo-models",this.photoId).then(function(e){if(!e)throw new Error("[photo-well-view] Invalid photoModel returned from getModel");t.set("photo",e)})),this.contextData&&this.contextData.modelName&&this.contextData.params&&n.push(this.appContext.getModelRegistry(this.contextData.modelName).then(function(e){var n;if(e){n=e.attributeSearch(t.contextData.params);if(n&&n.length&&e.exists(n[0]))return t.appContext.getModel(t.contextData.modelName,n[0]).then(function(e){e&&t.set("contextModel",e)})}}).then(null,function(){return"whatever"})),e.Promise.all(n)},setLinkAsAdFriendly:function(e){var t=e.currentTarget;t.hasClass("navigate-next")?this.appContext.adManager.setAdCouldBeShown(!0,"next",t.getAttribute("href")):this.appContext.adManager.setAdCouldBeShown(!0,"previous",t.getAttribute("href"))},animateNavigation:function(){var t=e.all(".navigate-target"),n=this.get("container"),r=n.one(".photo-sidebar-toggle-view"),i=n.one(".attribution-view"),s=1500,o=250,u=!1,a=!1,f,l=!0,c=this;s=(s-500)/2,u=!0,a=this.appContext.experiments.fullscreen.getMode(),this.registerEventHandler(this.get("container").on("mousemove",e.betterThrottle(function(e){f=n.one(".photo-sidebar-actions-view"),t&&l&&t.removeClass("is-hidden"),u&&l&&(f&&f.removeClass("is-hidden"),r&&r.removeClass("is-hidden"),i&&i.removeClass("is-hidden")),clearTimeout(c.movingTimeout),clearTimeout(c.initialTimeout),l=!0,c.followViewOpen||(c.movingTimeout=setTimeout(c.hideUI.bind(c),s*2))},o))),!this.firstLoad&&this.contextData.modelName!=="photoList-models"&&this.contextData.modelName!=="explore-models"&&(l=!1),c.initialTimeout=setTimeout(function(){l=!0,f=n.one(".photo-sidebar-actions-view"),t&&c.firstLoad&&t.addClass("is-hidden"),u&&l&&(f&&f.addClass("is-hidden"),r&&r.addClass("is-hidden"),i&&i.addClass("is-hidden"))},s*2)},hideUI:function(){var e=this.get("container"),t=e.one(".photo-sidebar-actions-view"),n=e.one(".photo-sidebar-toggle-view"),r=e.one(".attribution-view");t&&t.addClass("is-hidden"),n&&n.addClass("is-hidden"),r&&r.addClass("is-hidden")},onSubviewEvent:function(e,t){var n=1500;n=(n-500)/2,e==="attribution-view"&&
t[0]==="isOpen"?(this.followViewOpen=!0,clearTimeout(this.movingTimeout),clearTimeout(this.initialTimeout)):e==="attribution-view"&&t[0]==="isClosed"&&(this.followViewOpen=!1,this.movingTimeout=setTimeout(this.hideUI.bind(this),n*2))},activate:function(){var r=this,i=this.contextData,s=this.get("container"),o=0,u,a,f,l,c=".navigate-prev",h=".navigate-next";return YUI.Env.isServer||(a=e.getLocation(),f=a.protocol,l=a.hostname,r.appContext.getModel(i.modelName,i.params).then(function(e){r.set("contextModel",e)},function(t){if(!t.getModelFailure&&t.code!==1||i.modelName==="photostream-models")throw e.all(c).hide(),e.all(h).hide(),t;return r.contextData.modelName="photostream-models",r.contextData.params.id=r.get("photo").getValue("owner").getValue("nsid"),r.appContext.getModel("photostream-models",r.contextData.params).then(function(e){r.set("contextModel",e)})}).then(function(){var t=r.get("contextModel").getValue("photoContextList"),n=t.getList(),s,u,a,p,d;return n.length>2&&n.some(function(e){return o++,e.getValue("id")===r.photoId})&&(u=n.slice(o-2,o-1),a=n.slice(o,o+1),u&&u.length>0&&(p=r.setupNavLink(u[0],c,"previous"),p&&(r.updateNavLinks(c,f,l,p),r.get("container").all(c).removeClass("no-click"))),a&&a.length>0&&(d=r.setupNavLink(a[0],h,"next"),d&&(r.updateNavLinks(h,f,l,d),r.get("container").all(h).removeClass("no-click")))),s=e.merge(i.params,{photoId:r.photoId,numNext:10,numPrev:10}),t.getContext(s)}).then(function(i){function s(s,o){var u=r.get("container").all(s),a,c,h,p,d,v,m=i&&i[o]&&i[o].length;if(!u.size())return;if(!m){u.remove();return}u.removeClass("no-click"),a=r.setupNavLink(i[o][0],s,o);if(r.isAd)h=r.appContext.adManager.origin,o===h.arrow?(u.setAttribute("href",h.url),u.removeClass("is-hidden")):(u.setAttribute("href",a),u.removeClass("is-hidden"));else{r.updateNavLinks(s,f,l,a),c=r.subviews["photo-well-media-view"].getCanvasSize();for(v=0;v<n;v++){if(!i[o][v])break;p=i[o][v].getSizeToFit(c,{includeSizes:["sq","q","t","s","n"]}),p&&p.url&&(d=new Image,d.src=p.url)}for(v=0;v<t;v++){if(!i[o][v])break;p=i[o][v].getSizeToFit(c),p&&p.url&&(d=new Image,e.config.win.LH.mark("mark_time_to_load_photo_only_start"),d.onload=function(){e.config.win.LH.mark("mark_time_to_load_photo_only"),e.config.win.LH.measure("time_to_load_photo_only",{startMark:"mark_time_to_load_photo_only_start",endMark:"mark_time_to_load_photo_only"})},d.src=p.url)}}}r.appContext.adManager.updateContext({prev:i.previous[0],current:r.get("photo"),next:i.next[0],type:r.contextData.modelName}),s(h,"next"),s(c,"previous"),r.animateNavigation(),r.isAd&&r.appContext.adManager.markAdAsSeen()},function(e){if(e.notInContext||e.code===99)return r.get("contextModel").setValue("photoContextList",[]),r.contextData.modelName="photostream-models",r.contextData.params.id=r.get("photo").getValue("owner").getValue("nsid"),r.activate();throw e}).then(null,function(t){e.Flog.warn("There was a problem initializing the next/previous controls.",t&&t.message?t.message:t,t&&t.stack?t.stack:"")}),this.attachKeyEvent("down:37,75,39,74",r.handlePrevNextKeys.bind(r)),this.get("photo").getValue("isOwner")||this.appContext.getViewCounter().queue(this.get("photo").getValue("id"),this.publisherUrl||this.appContext.getReferrer())),s&&s.one(".feedback-widget button")&&(this.registerEventHandler(s.one(".feedback-widget button").on("mousedown",r.handleFeedbackClick,r)),this.setupFeedbackDropdown(),e.Env.isServer||s.all("input[name=redirect_url]").setAttribute("value",e.config.win.location.pathname)),u={":ad":r.setLinkAsAdFriendly},r.attachEvents(u),this},setupNavLink:function(t,n,r){var i=this.get("container").all(n),s,o;if(!t&&i.size()){i.remove();return}s=t,o=e.URLHelper.getPhotoPage({photoId:s.getValue("id"),pathAlias:s.getValue("owner").getValue("pathAlias"),contextSuffix:this.get("contextModel").getValue("urlSuffix"),lightbox:this.appContext.experiments.fullscreen.getMode()});if(!o||o==="#"){e.Flog.warn("[photo-well-view] Invalid next/prev URL:",o),i.remove();return}return o},updateNavLinks:function(e,t,n,r){var i=this.get("container").all(e);i.setAttribute("href",t+"//"+n+r),this.firstLoad&&i.removeClass("is-hidden")},destructor:function(){clearTimeout(this.movingTimeout),clearTimeout(this.initialTimeout),this.movingTimeout=null,this.initialTimeout=null},setupFeedbackDropdown:function(){var t=this.get("container"),n,r,i;if(this.appContext.flipper.isFlipped("buckets"))switch(this.appContext.buckets.photo_page){case"bucket1":i="https://yahoo.uservoice.com/forums/230780-flickr-photo-page-beta/";break;case"bucket2":i="https://yahoo.uservoice.com/forums/230781-flickr-photo-page-beta-2/";break;case"bucket3":i="https://yahoo.uservoice.com/forums/230782-flickr-photo-page-beta-3/";break;case"bucket4":i="https://yahoo.uservoice.com/forums/230783-flickr-photo-page-beta-4/";break;case"bucket5":i="https://yahoo.uservoice.com/forums/230785-flickr-photo-page-beta-5";break;case"bucket6":i="https://yahoo.uservoice.com/forums/230786-flickr-photo-page-beta-6";break;case"bucket7":i="https://yahoo.uservoice.com/forums/230787-flickr-photo-page-beta-7/";break;case"bucket8":i="https://yahoo.uservoice.com/forums/230788-flickr-photo-page-beta-8/";break;default:i="https://yahoo.uservoice.com/forums/224533-flickr-photo-page-beta"}else i="https://yahoo.uservoice.com/forums/224533-flickr-photo-page-beta";r=[{buttonMarkup:new e.Handlebars.SafeString('<a href="'+i+'" data-track="helpFeedbackUserVoiceClick" class="ui-button" target="_blank"><span>Feedback</span></a>')},{buttonMarkup:new e.Handlebars.SafeString('<a href="//'+e.config.flickr.url.host+'/help/photos/#167391143" data-track="helpFeedbackFAQClick" class="ui-button" target="_blank"><span>FAQs</span></a>')}],n=this.templates("reboot-welcome-dialog-content")({"opt-out-enabled":this.appContext.experiments.optOut.enabled()}),this.appContext.experiments.optOut.enabled()&&r.push({buttonMarkup:new e.Handlebars.SafeString(this.templates("photo-opt-out")({"redirect-url":e.config.win.location.pathname}))}),this.feedbackDialog=
e.Views.dialog.getNewInstance("dialog-cta",{attrs:{title:"Welcome to the beta of the new photo page!",hideConfirmButton:!0,verticalButtonList:!0,additionalButtons:r},content:n,parent:this,rootEl:t.ancestor()}),this.feedbackDialog.get("container").addClass("welcome-dialog")},handleFeedbackClick:function(t){if(t.target.ancestor(".ui-dialog",!0))return;t.halt(),this.feedbackDialog.toggle(),e.rapidTracker.beacon(this.name,"helpFeedbackMenuClick")},handlePrevNextKeys:function(t){var n=this,r,i,s,o=50;if(t.button===37||t.button===75)i=".navigate-prev",s="previous",e.rapidTracker.beacon(this.name,"prevPhotoKeyPress");else if(t.button===39||t.button===74)i=".navigate-next",s="next",e.rapidTracker.beacon(this.name,"nextPhotoKeyPress");i&&n.get("container").one(i)&&(t.preventDefault(),r=n.get("container").one(i).getAttribute("href"),r&&r!=="#"&&(n.keyboardNavigation&&n.keyboardNavigation.url&&r===n.keyboardNavigation.url&&(new Date).getTime()-n.keyboardNavigation.time<o?e.Flog.debug("[photo-well-view] Ignoring duplicate keyboard navigation within "+o+"ms",r):(n.keyboardNavigation={url:r,time:(new Date).getTime()},this.appContext.adManager.setAdCouldBeShown(!0,s,r),n.appContext.flapp.navigate(r))))},handleContextMenu:function(e){e.preventDefault(),this.fire("subviewViewEvent","rightClickPhoto")}})},"@VERSION@",{requires:["yui-throttle","flickr-view","hermes-template-photo-well","photo-well-css","url-helper","better-throttle","hermes-template-reboot-welcome-dialog-content","hermes-template-photo-opt-out","flog"],optional:["photo-well-media-view","photo-models","photo-route"],langBundles:["common"]});
YUI.add("photo-page-lightbox-scrappy-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){var n=this;return this.backToURL=t.backToURL,this.entryTypeIntlKey=t.entryTypeIntlKey,this.photoId=t.photoId,this.isOwner=t.isOwner,this.context=e.clone(t.context,!0),this.appContext.experiments.fullscreen.enableFullscreen(),t.realFullscreen=!0,t.isOwner=this.isOwner,this.enableZoom=this.appContext.flipper.isFlipped("enable-scrappy-zoom"),this.appContext.getViewer().signedIn&&(t.signinPendingQueue=e.SigninHelper.checkPendingQueue(this.appContext)),this.appContext.getModel("photo-models",this.photoId).then(function(t){t.on("valuesChanged",function(t){t.title&&e.one("head title").set("text",n.intlMessage({intlName:"photo-page-scrappy.PAGE_TITLE",title:t.title.newVal}))})}),this},subviewConfig:{"photo-well-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,dealbreaker:!0},"photo-head-meta-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},buildContainer:function(){var t,n=this.subviews["photo-well-view"].get("container");return n.addClass("scrappy-photo-page-enabled"),n.addClass("is-real-fullscreen"),this.enableZoom&&n.addClass("enable-zoom"),t=this.templates("photo-page-lightbox")({"photo-well-view":n}),this.setContainerHTML(t),e.fletrics.increment("test.photo.page.requests"),this},activate:function(){return this},closeDialog:function(t){e.config.win.location.href=this.backToURL},getTrackingSegments:function(){return{context:this.context.modelName.replace("-models",""),vwrOwner:this.isOwner?1:0}},destructor:function(){clearTimeout(this.scrollTimeout)}},{ATTRS:{spaceid:{value:792600552}}}),e.Base.plug(e.Views[this.name],e.Plugin.FlickrView.TTFPRecorderPlugin,{selector:".main-photo"})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-page-lightbox","photo-css","util-css","fletrics","ttfp-recorder-plugin","signin-helper","hermes-template-error-500","url","fluid-css"],optional:["photo-well-view","photo-head-meta-view"],langBundles:["common","photo-page-scrappy"]});
YUI.add("photo-route",function(e){function n(e){n.superclass.constructor.call(this,e)}var t={activity_feed:{backToIntlKey:"BACK_TO_ACTIVITY_FEED",usesWith:!1},album:{backToIntlKey:"BACK_TO_ALBUM",usesWith:!0},commons:{backToIntlKey:"BACK_TO_COMMONS",usesWith:!1},contacts_list:{backToIntlKey:"BACK_TO_CONTACTS_LIST",usesWith:!1},explore:{backToIntlKey:"BACK_TO_EXPLORE",usesWith:!0},favorites:{backToIntlKey:"BACK_TO_FAVORITES",usesWith:!0},gallery:{backToIntlKey:"BACK_TO_GALLERY",usesWith:!0},groups:{backToIntlKey:"BACK_TO_GROUPS"},group:{backToIntlKey:"BACK_TO_GROUP",usesWith:!0,withParamName:"pool/with"},map:{backToIntlKey:"BACK_TO_MAP",usesWith:!1},photostream:{backToIntlKey:"BACK_TO_PHOTOSTREAM",usesWith:!0},profile:{backToIntlKey:"BACK_TO_PROFILE",usesWith:!1},search:{backToIntlKey:"BACK_TO_SEARCH",usesWith:!1},shares:{backToIntlKey:"BACK_TO_SHARED_PHOTOS",usesWith:!1}};e.Routes[this.name]=n,e.extend(n,e.FlickrRoute,{langBundles:this.details.langBundles,run:function(t,n){var r=this,i=t.params.nsid_or_path_alias,s=t.params.photo_id,o=t.params.context,u=t.params.lightbox==="lightbox",a=t.params.comment_id,f={id:s},l=t.query||{},c=!1,h;return a&&n.redirect(t.url.replace("/"+a,"")+"#"+a),e.TypeValidator.matches.nsid(i)?f.userId=i:f.pathAlias=i,h=r.parseContext(o,i,t),h&&h.params&&h.params.isSharedEntity?this.appContext.setGPCredentials({gp_code:h.params.gpCode,gp_owner:h.params.gpOwner,share_code:h.params.gpCode}):this.appContext.setGPCredentials(null),l&&l.cr!==undefined&&(c=!0),this.appContext.flipper.isFlipped("get-context-photos-in-photo-page-route")&&(h&&h.params&&h.modelName&&h.modelName!=="photostream-models"?f.context=o:f.context="photostream"),this.appContext.getModel("photo-models",f).then(function(s){var a,f,l,p,d,v,m,g,y,b,w;v=u?"photo-page-lightbox-scrappy-view":"photo-page-scrappy-view",m="scrolling",g="photo-page-ad-scrappy-view",y="scrolling",a=r.verifyPhotoIsViewable(s),d=r.detectRouteErrors(a);if(d.length)return r.displayRouteErrors(t,d);f=r.verifyPhotoIsOwnedByPerson(s,i),w=f,d=r.detectRouteErrors(f);if(d.length)return r.displayRouteErrors(t,d);var E=6,S=12;r.appContext.forceServerRender&&(E=2,S=0),r.detectBackToDestination(t,{person:i,photoId:a,context:o}),b=r.getBackToData();if(d.length)return r.displayRouteErrors(t,d);h.modelName==="photostream-models"&&(h.params.id=e.Models[h.modelName].buildCompoundId(f,h.params.orderBy,h.params.viewAs),w=h.params.id,delete h.params.pathAlias);if(r.appContext.adManager.isEnabled()&&r.appContext.adManager.adNext()&&!u&&!t.UA.isMobileBrowser){p=r.appContext.adManager.getAdJSON();if(p&&e.Lang.isObject(p))return l=p.brand||"",{view:g,params:{ad:!0,photoId:a,nsid:f,photostreamId:w,context:h,backToURL:b.path,hideBackToLink:c,entryTypeIntlKey:b.backToIntlKey,numberOfPositionsToPreFetch:E,numberOfPositionsToRefetchAt:S},title:l,layout:y,fluid:!0};e.Flog.fatal("Could not extract brand name from brand payload",{ad:p})}var x=!0,T=!1;return r.appContext.flipper.isFlipped("enable-new-mobile-photo-page")&&r.isProcessedAsMobileRequest(t,n)&&(v="mobile-photo-page-view",x=!1,T=!0),t.UA.isFacebook&&(v="photo-page-meta-tags-only",m="opengraph",x=!1),{view:v,params:{photoId:a,nsid:f,photostreamId:w,context:h,backToURL:b.path,hideBackToLink:c,entryTypeIntlKey:b.backToIntlKey,fullscreen:u,numberOfPositionsToPreFetch:E,numberOfPositionsToRefetchAt:S},title:s.getValue("title")||"Untitled",layout:m,fluid:!0,darkLoader:x,isMobile:T}},function(n){var i="Couldn't load photo page";t.UA.isMobileBrowser&&r.appContext.flipper.isFlipped("enable-new-mobile-photo-page")&&(i="Couldn't load mobile photo page"),n.message&&(i+=": "+n.message);if(n.code===1)return e.fletrics.increment("route.photo.route.404"),r.displayRouteErrors(t,new e.RouteError(404,i));if(n.code===2&&!r.appContext.getViewer().signedIn)return e.Promise.resolve({redirect:"/signin/?redir="+t.url});if(n.fatal)throw e.fletrics.increment("route.photo.route.500"),n;return e.fletrics.increment("route.photo.route.404"),r.displayRouteErrors(t,new e.RouteError(404,i))})},verifyPhotoIsViewable:function(t){var n=t.getValue("id");return e.TypeValidator.matches.photoId(n)?n:new e.RouteError(404,this.intlMessage({intlName:"photo-page-scrappy.NO_PHOTO_WITH_THAT_ID",photoId:n}))},verifyPhotoIsOwnedByPerson:function(t,n){var r=t.getValue("id"),i=e.TypeValidator.matches.nsid(n);return n===t.getValue("owner").getValue(i?"id":"pathAlias")?t.getValue("owner").getValue("id"):new e.RouteError(404,"Photo "+r+" is not owned by "+n)},parseContext:function(t,n,r){return t=t||"photostream",e.URLHelper.parseContextURL(t,n,this.appContext)},detectBackToDestination:function(t,n){var r,i,s,o,u;if(e.config.flickr.homerun&&(e.config.flickr.ycParam||t.query&&t.query.yc)){u=e.config.flickr.ycParam?e.config.flickr.ycParam:t.query.yc;if(e.config.flickr.homerun.yc.indexOf(u.replace(/https?\:\/\//,""))!==-1)return this.setBackToData({name:"Yahoo"},u.match(/https?:/)?u:"https://"+u,n)}if(YUI.Env.isServer){r=t.headers.referrer||t.headers.referer;if(/^https?:\/\/[^\/]*(?:flickr\.com|flic\.kr)(?:$|\/)/.test(r)){if(n.context)return i=e.URLHelper.getContextEntity(n.context,n.person),this.setBackToData(e.URLHelper.getSiteSectionByName(i.type),i.url,n);r="/"+r.split("/").slice(3).join("/"),o=e.URLHelper.getSiteSectionByURL(r);if(o)return this.setBackToData(o,o.match,n)}else if(n.context)return i=e.URLHelper.getContextEntity(n.context,n.person),this.setBackToData(e.URLHelper.getSiteSectionByName(i.type),i.url,n)}else{r=this.appContext.getPreviousURL(),s=this.appContext.flapp.get("activeView");if(["photo-page-scrappy-view","photo-page-lightbox-scrappy-view","minimal-photo-page-view","photo-page-ad-scrappy-view"].indexOf(s.name)>-1){if(s.backToURL){o=e.URLHelper.getSiteSectionByURL(s.backToURL);if(o)return this.setBackToData(o,s.backToURL,n)}}else if(r!==e.config.win.location.pathname){o=e.URLHelper.getSiteSectionByURL(r);if(o)return this.setBackToData(o,o.match,n)}}return this.setBackToData(null,null,n)},setBackToData:function(r,i,s){var o=YUI.Env.isServer?
this:n,u,a,f;u=r?t[r.name]:null,u||(r=e.URLHelper.getSiteSectionByName("photostream"),i="/photos/"+s.person,u=t.photostream),a=e.merge(u,r),f=a.withParamName||"with",i=this.stripPathSuffixes(i),a.usesWith&&(i=i.replace(/([^\/])$/,"$1/"),i+=f+"/"+s.photoId),i[i.length-1]!=="/"&&i.indexOf("?")===-1&&(i+="/"),o._entryType=a.name,o._entryPath=i,o._backToIntlKey=a.backToIntlKey},getBackToData:function(){var e=YUI.Env.isServer?this:n;return{type:e._entryType,path:e._entryPath,backToIntlKey:e._backToIntlKey}},stripPathSuffixes:function(e){return e=e.replace(/\/+/g,"/"),e=e.replace(/\/with\/\d+\/?$/,"/"),e=e.replace(/\/in\/[^\/]+\/?$/,"/"),e=this.filterURL(e,function(e){var t;if(e.length>=3)for(t=2;t<e.length;t++)e[t].match(/page\d+/)&&(e.splice(t,1),t--);return e}),e=this.filterURL(e,function(e){var t;if(e[0]==="groups"&&e.length>=3)for(t=2;t<e.length;t++)e[t]==="pool"&&(e.splice(t,1),t--);return e}),e},filterURL:function(e,t){var n,r;return r=e.split("/").filter(function(e){return!!e}),n="/"+t(r).join("/"),n[n.length-1]!=="/"&&e.indexOf("?")===-1&&(n+="/"),n}}),e.mix(n.prototype,e.Localizable),e.mix(n.prototype,e.Seo)},"@VERSION@",{requires:["flog","flickr-route","type-validator","url-helper","fletrics","localizable","seo"],optional:["photo-models","photostream-models","photo-page-scrappy-view","photo-page-lightbox-scrappy-view","mobile-photo-page-view"],langBundles:["photo-page-scrappy","common","attribution"]});
YUI.add("photo-head-meta-view",function(e){var t=e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this},subviewConfig:{},buildContainer:function(){return this},loadState:function(){var t=this;return e.Promise.all([t.appContext.getModel("photo-head-meta-models",t._params.photoId),t.appContext.getModel("photo-models",t._params.photoId),t.appContext.getModel("photo-privacy-models",t._params.photoId)]).then(function(e){t.set("photo-meta",e[0]),t.set("photo",e[1]),t.set("photo-privacy",e[2])})},buildHeadContainer:function(){var t=this.get("photo-meta"),n=this.get("photo"),r=this.get("photo-privacy"),i=e.url(),s=t.getFieldsForDisplay(),o="",u=this,a=[{id:"canonicalurl",rel:"canonical",href:i+n.getValue("url")},{rel:"alternative",type:"application/json+oembed",href:i+"/services/oembed?url="+encodeURI(i+n.getValue("url"))+"&format=json",title:n.getValue("title")},{rel:"alternative",type:"text/xml+oembed",href:i+"/services/oembed?url="+encodeURI(i+n.getValue("url"))+"&format=xml",title:n.getValue("title")},{rel:"alternative",media:"only screen and (max-width: 640px)",href:"https://m.flickr.com"+encodeURI(n.getValue("url")+"/")}];s["al:ios:url"]||(s["al:ios:url"]="flickr://flickr.com"+n.getValue("url")),o+=this.templates("head-meta")({isName:!0,metaName:"description",metaValue:n.getValue("description")||n.getValue("title")})+"\n";var f="noarchive";return r.getValue("isPublic")||(f+=", noindex"),o+=this.templates("head-meta")({isName:!0,metaName:"robots",metaValue:f}),o+=this.templates("head-meta")({isName:!0,metaName:"googlebot",metaValue:f}),Object.keys(s).forEach(function(e){typeof s[e]=="object"&&e==="pinterest"?o+=u.templates("head-meta")({metaName:e,noPin:!0,metaValue:s[e].nopin,metaDescription:s[e].reason,isName:!0})+"\n":e==="og:description"?o+=u.templates("head-meta")({metaName:e,metaValue:s[e]})+"\n":e==="title"?o+=u.templates("head-meta")({isName:!0,metaName:"title",metaValue:s[e]})+"\n":e==="keywords"?o+=u.templates("head-meta")({isName:!0,metaName:e,metaValue:s[e]})+"\n":e==="noindexfollow"?s[e]&&(s[e]>0||s[e]!=="")&&(o+=u.templates("head-meta")({isName:!0,metaName:"robots",metaValue:"noindex,follow"})+"\n",o+=u.templates("head-meta")({isName:!0,metaName:"googlebot",metaValue:"noindex,follow"})+"\n"):o+=u.templates("head-meta")({metaName:e,metaValue:s[e]})+"\n"}),a.forEach(function(e){e.addedBy=u.name,o+=u.templates("head-link")(e)+"\n"}),this.set("headContainer",o),YUI.Env.isServer||this.updateHead(),this}});return e.mix(t.prototype,e.Seo),t},"@VERSION@",{requires:["flickr-view","hermes-template-head-meta","hermes-template-head-link"],optional:["photo-head-meta-models","photo-route","url","seo"],langBundles:["meta","common","attribution","share-modal"]});
YUI.add("flickr-photos-getPerms-fetcher",function(e,t){"use strict";function n(e,t){var n=e[0],r=e[1],i;i={id:t.id,isPublic:n.perms.ispublic,isVisibleByFriends:n.perms.isfriend,isVisibleByFamily:n.perms.isfamily,permAddMeta:n.perms.permaddmeta,permComment:n.perms.permcomment},r.addOrUpdate(i)}function r(n,r){var i=n.id,s={photo_id:i},o=this;return e.Promise.all([r.callAPI("flickr.photos.getPerms",s),r.getModelRegistry("photo-privacy-models")]).then(function(e){return o._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-photos-getPerms"]={run:r,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-privacy-models"]});
YUI.add("photo-privacy-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getInfo"].run(t,this.appContext)},update:function(t,n){var r;return r={photo_id:t,is_public:this.getValue(t,"isPublic"),is_friend:this.getValue(t,"isVisibleByFriends"),is_family:this.getValue(t,"isVisibleByFamily"),perm_addmeta:this.getValue(t,"permAddMeta"),perm_comment:this.getValue(t,"permComment")},e.ModelUpdaters["flickr-photos-setPerms"].run(r,this.appContext)},batchUpdate:function(t,n){var r;switch(!0){case"privacy"in n&&"commenting"in n&&"addMeta"in n:r={photo_ids:t,is_public:n.privacy.isPublic,is_friend:n.privacy.isVisibleByFriends,is_family:n.privacy.isVisibleByFamily,perm_addmeta:n.addMeta,perm_comment:n.commenting};break;case"privacy"in n&&"commenting"in n:r={photo_ids:t,is_public:n.privacy.isPublic,is_friend:n.privacy.isVisibleByFriends,is_family:n.privacy.isVisibleByFamily,perm_comment:n.commenting};break;case"privacy"in n&&"addMeta"in n:r={photo_ids:t,is_public:n.privacy.isPublic,is_friend:n.privacy.isVisibleByFriends,is_family:n.privacy.isVisibleByFamily,perm_addmeta:n.addMeta};break;case"commenting"in n&&"addMeta"in n:r={photo_ids:t,perm_addmeta:n.addMeta,perm_comment:n.commenting};break;case"privacy"in n:r={photo_ids:t,is_public:n.privacy.isPublic,is_friend:n.privacy.isVisibleByFriends,is_family:n.privacy.isVisibleByFamily};break;case"commenting"in n:r={photo_ids:t,perm_comment:n.commenting};break;case"addMeta"in n:r={photo_ids:t,perm_addmeta:n.addMeta}}return r.full_response=1,e.ModelUpdaters["flickr-photos-setPerms"].run(r,this.appContext)}},attributes:{isPublic:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isVisibleByFriends:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isVisibleByFamily:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},permAddMeta:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},permComment:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-getPerms-fetcher","flickr-photos-setPerms-updater","attribute-helpers"]});
